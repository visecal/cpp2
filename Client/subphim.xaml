<Window x:Class="subphimv1.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:local="clr-namespace:subphimv1"
        xmlns:localModels="clr-namespace:subphimv1.Models"
        xmlns:localSelectors="clr-namespace:subphimv1.Selectors"
        xmlns:localConverters="clr-namespace:subphimv1.Converters" 
        xmlns:ffme="clr-namespace:Unosquare.FFME;assembly=ffme.win"
        xmlns:gif="http://wpfanimatedgif.codeplex.com"
        xmlns:controls="clr-namespace:subphimv1.Controls"
        mc:Ignorable="d"
        Title="AIOSubPhim" Height="800" Width="1440" xmlns:xctk="http://schemas.xceed.com/wpf/xaml/toolkit"
        WindowStartupLocation="CenterScreen"
        ResizeMode="CanResizeWithGrip"
        PreviewKeyDown="MainWindow_PreviewKeyDown" PreviewMouseLeftButtonUp="MainWindow_PreviewMouseLeftButtonUp">

    <Window.Resources>
        <localConverters:PresetBackgroundConverter x:Key="PresetBackgroundConverter"/>
        <localConverters:PercentageConverter x:Key="PercentageConverter"/>
        <localConverters:Base64ToImageConverter x:Key="Base64ToImageConverter"/>
        <localConverters:StyleStateToEffectConverter x:Key="StyleStateToEffectConverter"/>
        <localConverters:IsStylePresetVisibleConverter x:Key="IsStylePresetVisibleConverter"/>
        <localConverters:ColorToBrushConverter x:Key="ColorToBrushConverter"/>
        <localConverters:HexStringToBrushConverter x:Key="HexStringToBrushConverter"/>
        <localConverters:CachingWaveformConverter x:Key="CachingWaveformConverter"/>
        <localConverters:NewlineConverter x:Key="NewlineConverter"/>
        <BooleanToVisibilityConverter x:Key="BooleanToVisibilityConverter"/>
        <localConverters:HalfValueConverter x:Key="HalfValueConverter"/>
        <local:EnumToVisibilityConverter x:Key="EnumToVisibilityConverter"/>
        <local:NullToVisibilityConverter x:Key="NullToVisibilityConverter"/>
        <localConverters:DbToPositionConverter x:Key="DbToPositionConverter"/>
        <local:SizeToRectConverter x:Key="SizeToRectConverter"/>
        <localConverters:BarsWaveformGeometryConverter x:Key="BarsWaveformConverter"/>
        <localConverters:InvertBooleanConverter x:Key="InvertBooleanConverter"/>
        <localConverters:TruncatedFileNameConverter x:Key="TruncatedFileNameConverter"/>

        <localConverters:ToUpperConverter x:Key="ToUpperConverter"/>

        <DataTemplate x:Key="VideoClipTemplate" DataType="{x:Type localModels:TimelineClipViewModel}">
            <Border Background="Transparent" CornerRadius="4">
                <Border.Style>
                    <Style TargetType="Border">
                        <Setter Property="BorderBrush" Value="Transparent"/>
                        <Setter Property="BorderThickness" Value="0"/>
                        <Style.Triggers>
                            <DataTrigger Binding="{Binding IsSelected}" Value="True">
                                <Setter Property="BorderBrush" Value="White"/>
                                <Setter Property="BorderThickness" Value="3"/>
                            </DataTrigger>
                        </Style.Triggers>
                    </Style>
                </Border.Style>

                <Grid>
                    <Border Background="#FF00A6A6" BorderBrush="#FF5DD0D0" BorderThickness="1" CornerRadius="3" ClipToBounds="True">
                        <Grid>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="*"/>
                            </Grid.RowDefinitions>
                            <TextBlock Grid.Row="0" Text="{Binding DisplayName}" Margin="5,2" Foreground="White" TextTrimming="CharacterEllipsis" VerticalAlignment="Center" FontSize="10"/>
                            <Grid Grid.Row="1">
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="0.6*"/>
                                    <RowDefinition Height="0.4*"/>
                                </Grid.RowDefinitions>
                                <ItemsControl Grid.Row="0" ItemsSource="{Binding FilmstripThumbnails}">
                                    <ItemsControl.ItemsPanel>
                                        <ItemsPanelTemplate>
                                            <StackPanel Orientation="Horizontal" />
                                        </ItemsPanelTemplate>
                                    </ItemsControl.ItemsPanel>
                                    <ItemsControl.ItemTemplate>
                                        <DataTemplate>
                                            <Image Source="{Binding}"
                   Stretch="UniformToFill"
                   Width="80"
                   Height="60" />
                                        </DataTemplate>
                                    </ItemsControl.ItemTemplate>
                                </ItemsControl>

                                <Canvas x:Name="AudioCanvas" Grid.Row="1" Background="#80000000" ClipToBounds="True">
                                    <Path Fill="#60FFFFFF" IsHitTestVisible="False">
                                        <Path.Data>
                                            <MultiBinding Converter="{StaticResource BarsWaveformConverter}" ConverterParameter="Body">
                                                <Binding Path="WavePeaks" />
                                                <Binding ElementName="AudioCanvas" Path="ActualHeight" />
                                                <Binding ElementName="AudioCanvas" Path="ActualWidth" />
                                                <Binding Path="VolumeDb" FallbackValue="0.0"/>
                                                <Binding Path="WaveformVersion" />
                                                <Binding Path="SourceData.TrimStartOffset" />
                                                <Binding Path="Duration" />
                                                <Binding Path="SourceData.Duration" />
                                            </MultiBinding>
                                        </Path.Data>
                                    </Path>
                                    <Path Fill="#FF8C00" IsHitTestVisible="False">
                                        <Path.Data>
                                            <MultiBinding Converter="{StaticResource BarsWaveformConverter}" ConverterParameter="Peak">
                                                <Binding Path="WavePeaks" />
                                                <Binding ElementName="AudioCanvas" Path="ActualHeight" />
                                                <Binding ElementName="AudioCanvas" Path="ActualWidth" />
                                                <Binding Path="VolumeDb" FallbackValue="0.0"/>
                                                <Binding Path="WaveformVersion" />
                                                <Binding Path="SourceData.TrimStartOffset" />
                                                <Binding Path="Duration" />
                                                <Binding Path="SourceData.Duration" />
                                            </MultiBinding>
                                        </Path.Data>
                                    </Path>
                                    <Thumb x:Name="VolumeThumb" Height="2" Width="{Binding ElementName=AudioCanvas, Path=ActualWidth}" Cursor="SizeNS"
       DragStarted="VolumeThumb_DragStarted"
       DragDelta="VolumeThumb_DragDelta"
       DragCompleted="VolumeThumb_DragCompleted">
                                        <Thumb.Template>
                                            <ControlTemplate TargetType="Thumb">
                                                <Border Background="#CCFFFFFF" CornerRadius="1"/>
                                            </ControlTemplate>
                                        </Thumb.Template>
                                        <Canvas.Top>
                                            <MultiBinding Converter="{StaticResource DbToPositionConverter}">
                                                <Binding Path="VolumeDb" FallbackValue="0.0"/>
                                                <Binding ElementName="AudioCanvas" Path="ActualHeight"/>
                                            </MultiBinding>
                                        </Canvas.Top>
                                    </Thumb>
                                </Canvas>
                            </Grid>
                        </Grid>
                    </Border>
                    <Thumb x:Name="LeftHandle" Width="8" HorizontalAlignment="Left" Cursor="SizeWE">
                        <Thumb.Style>
                            <Style TargetType="Thumb">
                                <Setter Property="Background" Value="Transparent"/>
                                <Setter Property="Template">
                                    <Setter.Value>
                                        <ControlTemplate TargetType="Thumb">
                                            <Border Background="{TemplateBinding Background}"/>
                                        </ControlTemplate>
                                    </Setter.Value>
                                </Setter>
                                <Setter Property="IsEnabled" Value="False"/>
                                <Style.Triggers>
                                    <DataTrigger Binding="{Binding IsSelected}" Value="True">
                                        <Setter Property="IsEnabled" Value="True"/>
                                    </DataTrigger>
                                </Style.Triggers>
                            </Style>
                        </Thumb.Style>
                    </Thumb>
                    <Thumb x:Name="RightHandle" Width="8" HorizontalAlignment="Right" Cursor="SizeWE">
                        <Thumb.Style>
                            <Style TargetType="Thumb">
                                <Setter Property="Background" Value="Transparent"/>
                                <Setter Property="Template">
                                    <Setter.Value>
                                        <ControlTemplate TargetType="Thumb">
                                            <Border Background="{TemplateBinding Background}"/>
                                        </ControlTemplate>
                                    </Setter.Value>
                                </Setter>
                                <Setter Property="IsEnabled" Value="False"/>
                                <Style.Triggers>
                                    <DataTrigger Binding="{Binding IsSelected}" Value="True">
                                        <Setter Property="IsEnabled" Value="True"/>
                                    </DataTrigger>
                                </Style.Triggers>
                            </Style>
                        </Thumb.Style>
                    </Thumb>
                </Grid>
            </Border>
        </DataTemplate>
        <DataTemplate x:Key="AudioClipTemplate" DataType="{x:Type localModels:TimelineClipViewModel}">
            <Border Background="Transparent" CornerRadius="4">
                <Border.Style>
                    <Style TargetType="Border">
                        <Setter Property="BorderBrush" Value="Transparent"/>
                        <Setter Property="BorderThickness" Value="0"/>
                        <Style.Triggers>
                            <DataTrigger Binding="{Binding IsSelected}" Value="True">
                                <Setter Property="BorderBrush" Value="White"/>
                                <Setter Property="BorderThickness" Value="2"/>
                            </DataTrigger>
                        </Style.Triggers>
                    </Style>
                </Border.Style>
                <Grid>
                    <Border Background="#FF008060" BorderBrush="#FF40BF9C" BorderThickness="1" CornerRadius="3" ClipToBounds="True" MinHeight="20">
                        <Grid>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="*"/>
                            </Grid.RowDefinitions>
                            <TextBlock Grid.Row="0" Text="{Binding DisplayName}" Margin="5,2" Foreground="White" TextTrimming="CharacterEllipsis" VerticalAlignment="Center" FontSize="10"/>
                            <Canvas x:Name="AudioCanvas" Grid.Row="1" Background="#80000000" ClipToBounds="True">
                                <Path Fill="#007ACC" IsHitTestVisible="False">
                                    <Path.Data>
                                        <MultiBinding Converter="{StaticResource BarsWaveformConverter}" ConverterParameter="Body">
                                            <Binding Path="WavePeaks" />
                                            <Binding ElementName="AudioCanvas" Path="ActualHeight" />
                                            <Binding ElementName="AudioCanvas" Path="ActualWidth" />
                                            <Binding Path="VolumeDb" FallbackValue="0.0"/>
                                            <Binding Path="WaveformVersion" />
                                            <Binding Path="SourceData.TrimStartOffset" />
                                            <Binding Path="Duration" />
                                            <Binding Path="SourceData.OriginalDuration" />
                                        </MultiBinding>
                                    </Path.Data>
                                </Path>
                                <Path Fill="#FF8C00" IsHitTestVisible="False">
                                    <Path.Data>
                                        <MultiBinding Converter="{StaticResource BarsWaveformConverter}" ConverterParameter="Peak">
                                            <Binding Path="WavePeaks" />
                                            <Binding ElementName="AudioCanvas" Path="ActualHeight" />
                                            <Binding ElementName="AudioCanvas" Path="ActualWidth" />
                                            <Binding Path="VolumeDb" FallbackValue="0.0"/>
                                            <Binding Path="WaveformVersion" />
                                            <Binding Path="SourceData.TrimStartOffset" />
                                            <Binding Path="Duration" />
                                            <Binding Path="SourceData.OriginalDuration" />
                                        </MultiBinding>
                                    </Path.Data>
                                </Path>
                                <Thumb x:Name="VolumeThumb" Height="2" Width="{Binding ElementName=AudioCanvas, Path=ActualWidth}" Cursor="SizeNS"
       DragStarted="VolumeThumb_DragStarted"
       DragDelta="VolumeThumb_DragDelta"
       DragCompleted="VolumeThumb_DragCompleted">
                                    <Thumb.Template>
                                        <ControlTemplate TargetType="Thumb">
                                            <Border Background="#CCFFFFFF" CornerRadius="1"/>
                                        </ControlTemplate>
                                    </Thumb.Template>
                                    <Canvas.Top>
                                        <MultiBinding Converter="{StaticResource DbToPositionConverter}">
                                            <Binding Path="VolumeDb" FallbackValue="0.0"/>
                                            <Binding ElementName="AudioCanvas" Path="ActualHeight"/>
                                        </MultiBinding>
                                    </Canvas.Top>
                                </Thumb>
                            </Canvas>
                        </Grid>
                    </Border>
                    <Thumb x:Name="LeftHandle" Width="8" HorizontalAlignment="Left" Cursor="SizeWE">
                        <Thumb.Style>
                            <Style TargetType="Thumb">
                                <Setter Property="Background" Value="Transparent"/>
                                <Setter Property="Template">
                                    <Setter.Value>
                                        <ControlTemplate TargetType="Thumb">
                                            <Border Background="{TemplateBinding Background}"/>
                                        </ControlTemplate>
                                    </Setter.Value>
                                </Setter>
                                <Setter Property="IsEnabled" Value="False"/>
                                <Style.Triggers>
                                    <DataTrigger Binding="{Binding IsSelected}" Value="True">
                                        <Setter Property="IsEnabled" Value="True"/>
                                    </DataTrigger>
                                </Style.Triggers>
                            </Style>
                        </Thumb.Style>
                    </Thumb>
                    <Thumb x:Name="RightHandle" Width="8" HorizontalAlignment="Right" Cursor="SizeWE">
                        <Thumb.Style>
                            <Style TargetType="Thumb">
                                <Setter Property="Background" Value="Transparent"/>
                                <Setter Property="Template">
                                    <Setter.Value>
                                        <ControlTemplate TargetType="Thumb">
                                            <Border Background="{TemplateBinding Background}"/>
                                        </ControlTemplate>
                                    </Setter.Value>
                                </Setter>
                                <Setter Property="IsEnabled" Value="False"/>
                                <Style.Triggers>
                                    <DataTrigger Binding="{Binding IsSelected}" Value="True">
                                        <Setter Property="IsEnabled" Value="True"/>
                                    </DataTrigger>
                                </Style.Triggers>
                            </Style>
                        </Thumb.Style>
                    </Thumb>
                </Grid>
            </Border>
        </DataTemplate>
        <DataTemplate x:Key="ImageClipTemplate" DataType="{x:Type localModels:TimelineClipViewModel}">
            <Border Background="Transparent" CornerRadius="4">
                <Border.Style>
                    <Style TargetType="Border">
                        <Setter Property="BorderBrush" Value="Transparent"/>
                        <Setter Property="BorderThickness" Value="0"/>
                        <Style.Triggers>
                            <DataTrigger Binding="{Binding IsSelected}" Value="True">
                                <Setter Property="BorderBrush" Value="White"/>
                                <Setter Property="BorderThickness" Value="2"/>
                            </DataTrigger>
                        </Style.Triggers>
                    </Style>
                </Border.Style>
                <Grid>
                    <Border Background="#FF8A2BE2" BorderBrush="#FFC398F9" BorderThickness="1" CornerRadius="3" ClipToBounds="True">
                        <Grid>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="*"/>
                            </Grid.RowDefinitions>
                            <TextBlock Grid.Row="0" Text="{Binding DisplayName}" Margin="5,2" Foreground="White" TextTrimming="CharacterEllipsis" VerticalAlignment="Center" FontSize="10"/>
                            <ItemsControl Grid.Row="1" ItemsSource="{Binding FilmstripThumbnails}">
                                <ItemsControl.ItemsPanel>
                                    <ItemsPanelTemplate>
                                        <StackPanel Orientation="Horizontal"/>
                                    </ItemsPanelTemplate>
                                </ItemsControl.ItemsPanel>
                                <ItemsControl.ItemTemplate>
                                    <DataTemplate>
                                        <Image Source="{Binding}" Stretch="UniformToFill" Width="80"/>
                                    </DataTemplate>
                                </ItemsControl.ItemTemplate>
                            </ItemsControl>
                        </Grid>
                    </Border>
                    <Thumb x:Name="LeftHandle" Width="8" HorizontalAlignment="Left" Cursor="SizeWE">
                        <Thumb.Style>
                            <Style TargetType="Thumb">
                                <Setter Property="Background" Value="Transparent"/>
                                <Setter Property="Template">
                                    <Setter.Value>
                                        <ControlTemplate TargetType="Thumb">
                                            <Border Background="{TemplateBinding Background}"/>
                                        </ControlTemplate>
                                    </Setter.Value>
                                </Setter>
                                <Setter Property="IsEnabled" Value="False"/>
                                <Style.Triggers>
                                    <DataTrigger Binding="{Binding IsSelected}" Value="True">
                                        <Setter Property="IsEnabled" Value="True"/>
                                    </DataTrigger>
                                </Style.Triggers>
                            </Style>
                        </Thumb.Style>
                    </Thumb>
                    <Thumb x:Name="RightHandle" Width="8" HorizontalAlignment="Right" Cursor="SizeWE">
                        <Thumb.Style>
                            <Style TargetType="Thumb">
                                <Setter Property="Background" Value="Transparent"/>
                                <Setter Property="Template">
                                    <Setter.Value>
                                        <ControlTemplate TargetType="Thumb">
                                            <Border Background="{TemplateBinding Background}"/>
                                        </ControlTemplate>
                                    </Setter.Value>
                                </Setter>
                                <Setter Property="IsEnabled" Value="False"/>
                                <Style.Triggers>
                                    <DataTrigger Binding="{Binding IsSelected}" Value="True">
                                        <Setter Property="IsEnabled" Value="True"/>
                                    </DataTrigger>
                                </Style.Triggers>
                            </Style>
                        </Thumb.Style>
                    </Thumb>
                </Grid>
            </Border>
        </DataTemplate>
        <DataTemplate x:Key="SubtitleClipTemplate" DataType="{x:Type localModels:TimelineClipViewModel}">
            <Border Background="Transparent" CornerRadius="4">
                <Border.Style>
                    <Style TargetType="Border">
                        <Setter Property="BorderBrush" Value="Transparent"/>
                        <Setter Property="BorderThickness" Value="0"/>
                        <Style.Triggers>
                            <DataTrigger Binding="{Binding IsSelected}" Value="True">
                                <Setter Property="BorderBrush" Value="White"/>
                                <Setter Property="BorderThickness" Value="2"/>
                            </DataTrigger>
                        </Style.Triggers>
                    </Style>
                </Border.Style>
                <Grid>
                    <Border Background="#FFBF5B00" BorderBrush="#FFFFA500" BorderThickness="1" CornerRadius="3" MinHeight="20">
                        <Grid>
                            <TextBlock Text="{Binding DisplayName}" Margin="8,0" Foreground="White" TextTrimming="CharacterEllipsis" VerticalAlignment="Center" HorizontalAlignment="Left" FontSize="11"/>
                        </Grid>
                    </Border>
                    <Thumb x:Name="LeftHandle" Width="8" HorizontalAlignment="Left" Cursor="SizeWE">
                        <Thumb.Style>
                            <Style TargetType="Thumb">
                                <Setter Property="Background" Value="Transparent"/>
                                <Setter Property="Template">
                                    <Setter.Value>
                                        <ControlTemplate TargetType="Thumb">
                                            <Border Background="{TemplateBinding Background}"/>
                                        </ControlTemplate>
                                    </Setter.Value>
                                </Setter>
                                <Setter Property="IsEnabled" Value="False"/>
                                <Style.Triggers>
                                    <DataTrigger Binding="{Binding IsSelected}" Value="True">
                                        <Setter Property="IsEnabled" Value="True"/>
                                    </DataTrigger>
                                </Style.Triggers>
                            </Style>
                        </Thumb.Style>
                    </Thumb>
                    <Thumb x:Name="RightHandle" Width="8" HorizontalAlignment="Right" Cursor="SizeWE">
                        <Thumb.Style>
                            <Style TargetType="Thumb">
                                <Setter Property="Background" Value="Transparent"/>
                                <Setter Property="Template">
                                    <Setter.Value>
                                        <ControlTemplate TargetType="Thumb">
                                            <Border Background="{TemplateBinding Background}"/>
                                        </ControlTemplate>
                                    </Setter.Value>
                                </Setter>
                                <Setter Property="IsEnabled" Value="False"/>
                                <Style.Triggers>
                                    <DataTrigger Binding="{Binding IsSelected}" Value="True">
                                        <Setter Property="IsEnabled" Value="True"/>
                                    </DataTrigger>
                                </Style.Triggers>
                            </Style>
                        </Thumb.Style>
                    </Thumb>
                </Grid>
            </Border>
        </DataTemplate>
        <DataTemplate x:Key="TextClipTemplate" DataType="{x:Type localModels:TimelineClipViewModel}">
            <Border Background="Transparent" CornerRadius="4">
                <Border.Style>
                    <Style TargetType="Border">
                        <Setter Property="BorderBrush" Value="Transparent"/>
                        <Setter Property="BorderThickness" Value="0"/>
                        <Style.Triggers>
                            <DataTrigger Binding="{Binding IsSelected}" Value="True">
                                <Setter Property="BorderBrush" Value="White"/>
                                <Setter Property="BorderThickness" Value="2"/>
                            </DataTrigger>
                        </Style.Triggers>
                    </Style>
                </Border.Style>
                <Grid>
                    <Border Background="#FF4E86F9" BorderBrush="#FF85AFFF" BorderThickness="1" CornerRadius="3" MinHeight="20">
                        <Grid>
                            <TextBlock Text="{Binding DisplayName}" Margin="8,0" Foreground="White" TextTrimming="CharacterEllipsis" VerticalAlignment="Center" HorizontalAlignment="Left" FontSize="11"/>
                        </Grid>
                    </Border>
                    <Thumb x:Name="LeftHandle" Width="8" HorizontalAlignment="Left" Cursor="SizeWE">
                        <Thumb.Style>
                            <Style TargetType="Thumb">
                                <Setter Property="Background" Value="Transparent"/>
                                <Setter Property="Template">
                                    <Setter.Value>
                                        <ControlTemplate TargetType="Thumb">
                                            <Border Background="{TemplateBinding Background}"/>
                                        </ControlTemplate>
                                    </Setter.Value>
                                </Setter>
                                <Setter Property="IsEnabled" Value="False"/>
                                <Style.Triggers>
                                    <DataTrigger Binding="{Binding IsSelected}" Value="True">
                                        <Setter Property="IsEnabled" Value="True"/>
                                    </DataTrigger>
                                </Style.Triggers>
                            </Style>
                        </Thumb.Style>
                    </Thumb>
                    <Thumb x:Name="RightHandle" Width="8" HorizontalAlignment="Right" Cursor="SizeWE">
                        <Thumb.Style>
                            <Style TargetType="Thumb">
                                <Setter Property="Background" Value="Transparent"/>
                                <Setter Property="Template">
                                    <Setter.Value>
                                        <ControlTemplate TargetType="Thumb">
                                            <Border Background="{TemplateBinding Background}"/>
                                        </ControlTemplate>
                                    </Setter.Value>
                                </Setter>
                                <Setter Property="IsEnabled" Value="False"/>
                                <Style.Triggers>
                                    <DataTrigger Binding="{Binding IsSelected}" Value="True">
                                        <Setter Property="IsEnabled" Value="True"/>
                                    </DataTrigger>
                                </Style.Triggers>
                            </Style>
                        </Thumb.Style>
                    </Thumb>
                </Grid>
            </Border>
        </DataTemplate>
        <localSelectors:TimelineClipTemplateSelector x:Key="TimelineClipSelector" VideoClipTemplate="{StaticResource VideoClipTemplate}" AudioClipTemplate="{StaticResource AudioClipTemplate}" ImageClipTemplate="{StaticResource ImageClipTemplate}" SubtitleClipTemplate="{StaticResource SubtitleClipTemplate}" TextClipTemplate="{StaticResource TextClipTemplate}"/>
        <SolidColorBrush x:Key="CapCut.WindowBackground" Color="#FF18191C"/>
        <SolidColorBrush x:Key="CapCut.PanelBackground" Color="#FF242528"/>
        <SolidColorBrush x:Key="CapCut.LighterPanelBackground" Color="#FF303134"/>
        <SolidColorBrush x:Key="CapCut.BorderColor" Color="#FF3A3B3D"/>
        <SolidColorBrush x:Key="CapCut.TextColor" Color="#FFDEDEDE"/>
        <SolidColorBrush x:Key="CapCut.TextSecondaryColor" Color="#FFA9AAAB"/>
        <SolidColorBrush x:Key="CapCut.AccentColor" Color="#FF00A6A6"/>
        <SolidColorBrush x:Key="CapCut.AccentColorBlue" Color="#FF4E86F9"/>

        <Style x:Key="WindowButtonStyle" TargetType="Button">
            <Setter Property="FocusVisualStyle" Value="{x:Null}"/>
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="Foreground" Value="{StaticResource CapCut.TextColor}"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Width" Value="45"/>
            <Setter Property="Height" Value="32"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border Background="{TemplateBinding Background}">
                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                        </Border>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
            <Style.Triggers>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="Background" Value="{StaticResource CapCut.LighterPanelBackground}"/>
                </Trigger>
            </Style.Triggers>
        </Style>


        <Style x:Key="WindowCloseButtonStyle" TargetType="Button" BasedOn="{StaticResource WindowButtonStyle}">
            <Style.Triggers>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="Background" Value="#C42B1C"/>
                </Trigger>
            </Style.Triggers>
        </Style>
        <Style x:Key="PlayerControlButtonStyle" TargetType="Button">
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="Foreground" Value="{StaticResource CapCut.TextSecondaryColor}"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Padding" Value="8,5"/>
            <Setter Property="Margin" Value="5,0"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border Background="{TemplateBinding Background}" Padding="{TemplateBinding Padding}" CornerRadius="3">
                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter Property="Foreground" Value="{StaticResource CapCut.TextColor}"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
        <Style TargetType="Menu">
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="Foreground" Value="{StaticResource CapCut.TextColor}"/>
            <Setter Property="VerticalAlignment" Value="Center"/>
        </Style>

        <Style TargetType="{x:Type MenuItem}">
            <Setter Property="Background" Value="{StaticResource CapCut.PanelBackground}"/>
            <Setter Property="Foreground" Value="{StaticResource CapCut.TextColor}"/>
            <Setter Property="Padding" Value="10,8"/>
            <Setter Property="BorderBrush" Value="{StaticResource CapCut.BorderColor}"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="{x:Type MenuItem}">
                        <Grid SnapsToDevicePixels="True">
                            <Border x:Name="templateRoot" 
                            BorderBrush="{TemplateBinding BorderBrush}" 
                            BorderThickness="0" 
                            Background="{TemplateBinding Background}" 
                            SnapsToDevicePixels="True">
                                <Grid Margin="{TemplateBinding Padding}">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="Auto" MinWidth="22"/>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="Auto"/>
                                    </Grid.ColumnDefinitions>
                                    <ContentPresenter x:Name="Icon" Grid.Column="0" ContentSource="Icon" HorizontalAlignment="Center" VerticalAlignment="Center" Margin="0,0,8,0"/>
                                    <ContentPresenter Grid.Column="1" ContentSource="Header" RecognizesAccessKey="True" HorizontalAlignment="Left" VerticalAlignment="Center"/>
                                    <Path x:Name="rightArrow" Grid.Column="2" Data="M0,0L4,3.5L0,7" Stroke="{StaticResource CapCut.TextSecondaryColor}" StrokeThickness="1" VerticalAlignment="Center" HorizontalAlignment="Right" Visibility="Collapsed"/>
                                </Grid>
                            </Border>
                            <Popup x:Name="PART_Popup" AllowsTransparency="true" Focusable="false"   IsOpen="{Binding IsSubmenuOpen, RelativeSource={RelativeSource TemplatedParent}}" PopupAnimation="Fade">
                                <Border x:Name="SubMenuBorder" Background="{StaticResource CapCut.LighterPanelBackground}"  BorderBrush="{Binding BorderBrush, RelativeSource={RelativeSource TemplatedParent}}"  BorderThickness="{Binding BorderThickness, RelativeSource={RelativeSource TemplatedParent}}">
                                    <ScrollViewer CanContentScroll="true">
                                        <ItemsPresenter KeyboardNavigation.DirectionalNavigation="Cycle"/>
                                    </ScrollViewer>
                                </Border>
                            </Popup>
                        </Grid>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsChecked" Value="True">
                                <Setter TargetName="Icon" Property="Content">
                                    <Setter.Value>
                                        <Path Data="M0,5.2 L1.9,7.1 L5.9,3.1" Stroke="{StaticResource CapCut.AccentColorBlue}" StrokeThickness="2" Width="12" Height="12" Stretch="Uniform" VerticalAlignment="Center"/>
                                    </Setter.Value>
                                </Setter>
                                <Setter TargetName="Icon" Property="Visibility" Value="Visible"/>
                            </Trigger>
                            <MultiTrigger>
                                <MultiTrigger.Conditions>
                                    <Condition Property="Icon" Value="{x:Null}"/>
                                    <Condition Property="IsChecked" Value="False"/>
                                </MultiTrigger.Conditions>
                                <Setter TargetName="Icon" Property="Visibility" Value="Collapsed"/>
                            </MultiTrigger>
                            <Trigger Property="HasItems" Value="true">
                                <Setter TargetName="rightArrow" Property="Visibility" Value="Visible"/>
                            </Trigger>
                            <Trigger Property="IsHighlighted" Value="True">
                                <Setter Property="Background" Value="{StaticResource CapCut.LighterPanelBackground}"/>
                                <Setter TargetName="rightArrow" Property="Stroke" Value="{StaticResource CapCut.TextColor}"/>
                            </Trigger>
                            <Trigger Property="Role" Value="TopLevelHeader">
                                <Setter Property="Padding" Value="10,5"/>
                                <Setter Property="Background" Value="Transparent"/>
                                <Setter TargetName="PART_Popup" Property="Placement" Value="Bottom"/>
                                <Setter TargetName="SubMenuBorder" Property="Padding" Value="2"/>
                            </Trigger>
                            <Trigger Property="Role" Value="SubmenuHeader">
                                <Setter TargetName="PART_Popup" Property="Placement" Value="Right"/>
                            </Trigger>
                            <Trigger Property="IsEnabled" Value="False">
                                <Setter Property="Foreground" Value="{StaticResource CapCut.TextSecondaryColor}"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
        <Style x:Key="MediaBinMenuItemStyle" TargetType="MenuItem">
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="Foreground" Value="{StaticResource CapCut.TextColor}"/>
            <Setter Property="Padding" Value="10,8"/>
            <Setter Property="Height" Value="32"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="MenuItem">
                        <Border x:Name="templateRoot" 
                            Background="{TemplateBinding Background}" 
                            Padding="{TemplateBinding Padding}"
                            CornerRadius="3">
                            <ContentPresenter ContentSource="Header" RecognizesAccessKey="True" VerticalAlignment="Center"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsHighlighted" Value="True">
                                <Setter Property="Background" Value="{StaticResource CapCut.LighterPanelBackground}"/>
                            </Trigger>
                            <Trigger Property="IsEnabled" Value="False">
                                <Setter Property="Foreground" Value="{StaticResource CapCut.TextSecondaryColor}"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <Style TargetType="DataGrid">
            <Setter Property="Background" Value="{StaticResource CapCut.PanelBackground}"/>
            <Setter Property="BorderBrush" Value="{StaticResource CapCut.BorderColor}"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="HorizontalGridLinesBrush" Value="{StaticResource CapCut.BorderColor}"/>
            <Setter Property="VerticalGridLinesBrush" Value="{StaticResource CapCut.BorderColor}"/>
            <Setter Property="CanUserAddRows" Value="False"/>
            <Setter Property="CanUserDeleteRows" Value="False"/>
            <Setter Property="AutoGenerateColumns" Value="False"/>
            <Setter Property="HeadersVisibility" Value="Column"/>
            <Setter Property="GridLinesVisibility" Value="Horizontal"/>
            <Setter Property="RowBackground" Value="Transparent"/>
        </Style>

        <Style TargetType="DataGridColumnHeader">
            <Setter Property="Background" Value="{StaticResource CapCut.LighterPanelBackground}"/>
            <Setter Property="Foreground" Value="{StaticResource CapCut.TextSecondaryColor}"/>
            <Setter Property="FontWeight" Value="SemiBold"/>
            <Setter Property="Padding" Value="10,8"/>
            <Setter Property="BorderThickness" Value="0,0,0,1"/>
            <Setter Property="BorderBrush" Value="{StaticResource CapCut.BorderColor}"/>
            <Setter Property="HorizontalContentAlignment" Value="Left"/>
        </Style>

        <Style x:Key="CustomDataGridRowStyle" TargetType="DataGridRow">
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="Foreground" Value="{StaticResource CapCut.TextColor}"/>

            <Style.Triggers>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="Background" Value="{StaticResource CapCut.LighterPanelBackground}"/>
                </Trigger>
                <Trigger Property="IsSelected" Value="True">
                    <Setter Property="Background" Value="{StaticResource CapCut.AccentColorBlue}"/>
                    <Setter Property="Foreground" Value="White"/>
                </Trigger>
            </Style.Triggers>
        </Style>

        <Style TargetType="DataGridCell">
            <Setter Property="Padding" Value="10,8"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="{x:Type DataGridCell}">
                        <Border Padding="{TemplateBinding Padding}" 
                        BorderBrush="{TemplateBinding BorderBrush}" 
                        BorderThickness="{TemplateBinding BorderThickness}" 
                        Background="{TemplateBinding Background}" 
                        SnapsToDevicePixels="True">
                            <ContentPresenter SnapsToDevicePixels="{TemplateBinding SnapsToDevicePixels}"/>
                        </Border>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
            <Style.Triggers>
                <Trigger Property="IsSelected" Value="True">
                    <Setter Property="Foreground" Value="White"/>
                    <Setter Property="Background" Value="Transparent"/>
                </Trigger>
            </Style.Triggers>
        </Style>
        <Style x:Key="CropThumbCanvasStyle" TargetType="Canvas">
            <Setter Property="Visibility" Value="Collapsed"/>
            <Style.Triggers>
                <MultiDataTrigger>
                    <MultiDataTrigger.Conditions>
                        <Condition Binding="{Binding Source={x:Reference SubtitleTab}, Path=IsChecked}" Value="True"/>
                        <Condition Binding="{Binding Source={x:Reference ModeOcrRadio}, Path=IsChecked}" Value="True"/>
                    </MultiDataTrigger.Conditions>
                    <Setter Property="Visibility" Value="Visible"/>
                </MultiDataTrigger>
            </Style.Triggers>
        </Style>

        <Style x:Key="MainTabStyle" TargetType="ToggleButton">
            <Setter Property="FocusVisualStyle" Value="{x:Null}"/>
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="Foreground" Value="{StaticResource CapCut.TextSecondaryColor}"/>
            <Setter Property="BorderThickness" Value="0,0,0,2"/>
            <Setter Property="BorderBrush" Value="Transparent"/>
            <Setter Property="Padding" Value="12,10"/>
            <Setter Property="MinWidth" Value="80"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="ToggleButton">
                        <Border x:Name="border" Background="{TemplateBinding Background}"  BorderBrush="{TemplateBinding BorderBrush}" BorderThickness="{TemplateBinding BorderThickness}" Padding="{TemplateBinding Padding}">
                            <StackPanel Orientation="Horizontal" HorizontalAlignment="Center">
                                <TextBlock Text="{Binding Tag, RelativeSource={RelativeSource TemplatedParent}}"  FontFamily="Segoe MDL2 Assets, Segoe UI Symbol, Arial"  FontSize="18"  VerticalAlignment="Center"/>
                                <TextBlock Text="{TemplateBinding Content}"  FontSize="14"  Margin="8,0,0,0"  VerticalAlignment="Center"/>
                            </StackPanel>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter Property="Foreground" Value="{StaticResource CapCut.TextColor}"/>
                            </Trigger>
                            <Trigger Property="IsChecked" Value="True">
                                <Setter Property="Foreground" Value="{StaticResource CapCut.TextColor}"/>
                                <Setter TargetName="border" Property="BorderBrush" Value="{StaticResource CapCut.AccentColorBlue}"/>
                                <Setter Property="FontWeight" Value="SemiBold"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <Style x:Key="LeftNavRadioButtonStyle" TargetType="RadioButton">
            <Setter Property="FocusVisualStyle" Value="{x:Null}"/>
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="Foreground" Value="{StaticResource CapCut.TextColor}"/>
            <Setter Property="Padding" Value="5,5"/>
            <Setter Property="FontSize" Value="12"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="RadioButton">
                        <Border x:Name="border" 
                                Background="{TemplateBinding Background}" 
                                Padding="{TemplateBinding Padding}" 
                                CornerRadius="4">
                            <ContentPresenter HorizontalAlignment="Left" VerticalAlignment="Center"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="border" Property="Background" Value="{StaticResource CapCut.LighterPanelBackground}"/>
                            </Trigger>
                            <Trigger Property="IsChecked" Value="True">
                                <Setter TargetName="border" Property="Background" Value="{StaticResource CapCut.AccentColorBlue}"/>
                                <Setter Property="Foreground" Value="White"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <Style x:Key="ExpanderHeaderToggleStyle" TargetType="ToggleButton">
            <Setter Property="FocusVisualStyle" Value="{x:Null}"/>
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="Foreground" Value="{StaticResource CapCut.TextColor}"/>
            <Setter Property="FontSize" Value="14"/>
            <Setter Property="FontWeight" Value="SemiBold"/>
            <Setter Property="Padding" Value="15,12"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="ToggleButton">
                        <Border Background="{TemplateBinding Background}" Padding="{TemplateBinding Padding}">
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>
                                <ContentPresenter Grid.Column="0" ContentSource="Content" VerticalAlignment="Center"/>
                                <Path x:Name="Arrow" Grid.Column="1"  Data="M 0 0 L 4 4 L 8 0 Z"  Stroke="{TemplateBinding Foreground}"  StrokeThickness="1.5" VerticalAlignment="Center"/>
                            </Grid>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsChecked" Value="True">
                                <Setter TargetName="Arrow" Property="Data" Value="M 0 4 L 4 0 L 8 4 Z"/>
                            </Trigger>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter Property="Background" Value="{StaticResource CapCut.LighterPanelBackground}"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <Style x:Key="AccordionExpanderStyle" TargetType="Expander">
            <Setter Property="Foreground" Value="{StaticResource CapCut.TextColor}"/>
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="BorderThickness" Value="0,1,0,0"/>
            <Setter Property="BorderBrush" Value="{StaticResource CapCut.BorderColor}"/>
            <Setter Property="Padding" Value="0"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Expander">
                        <DockPanel>
                            <Border DockPanel.Dock="Top" 
                                    Background="{TemplateBinding Background}"
                                    BorderBrush="{TemplateBinding BorderBrush}"
                                    BorderThickness="{TemplateBinding BorderThickness}">
                                <ToggleButton x:Name="HeaderSite" IsChecked="{Binding IsExpanded, RelativeSource={RelativeSource TemplatedParent}, Mode=TwoWay}" Style="{StaticResource ExpanderHeaderToggleStyle}" Content="{TemplateBinding Header}"/>
                            </Border>
                            <ContentPresenter x:Name="ExpandSite"   DockPanel.Dock="Bottom"  Visibility="Collapsed" Margin="15,10,15,15"/>
                        </DockPanel>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsExpanded" Value="True">
                                <Setter TargetName="ExpandSite" Property="Visibility" Value="Visible"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <Style x:Key="PrimaryActionButtonStyle" TargetType="Button">
            <Setter Property="FocusVisualStyle" Value="{x:Null}"/>
            <Setter Property="Background" Value="{StaticResource CapCut.AccentColorBlue}"/>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="Padding" Value="15,8"/>
            <Setter Property="FontSize" Value="12"/>
            <Setter Property="FontWeight" Value="SemiBold"/>
            <Setter Property="VerticalAlignment" Value="Center"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border x:Name="border" Background="{TemplateBinding Background}" CornerRadius="4">
                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="border" Property="Background" Value="#FF6DA0FF"/>
                            </Trigger>
                            <Trigger Property="IsEnabled" Value="False">
                                <Setter TargetName="border" Property="Background" Value="#FF3A3B3D"/>
                                <Setter Property="Foreground" Value="{StaticResource CapCut.TextSecondaryColor}"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <Style x:Key="SectionHeaderStyle" TargetType="TextBlock">
            <Setter Property="FontSize" Value="14"/>
            <Setter Property="FontWeight" Value="SemiBold"/>
            <Setter Property="Margin" Value="0,10,0,5"/>
        </Style>
        <Style x:Key="EditorPanelToggleButtonStyle" TargetType="ToggleButton">
            <Setter Property="FocusVisualStyle" Value="{x:Null}"/>
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="Foreground" Value="{StaticResource CapCut.TextSecondaryColor}"/>
            <Setter Property="BorderBrush" Value="{StaticResource CapCut.BorderColor}"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="Width" Value="35"/>
            <Setter Property="Height" Value="30"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="ToggleButton">
                        <Border x:Name="border" Background="{TemplateBinding Background}"  BorderBrush="{TemplateBinding BorderBrush}" BorderThickness="{TemplateBinding BorderThickness}" CornerRadius="4" SnapsToDevicePixels="True">
                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                        </Border>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
            <Style.Triggers>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="Background" Value="{StaticResource CapCut.LighterPanelBackground}"/>
                    <Setter Property="Foreground" Value="{StaticResource CapCut.TextColor}"/>
                </Trigger>
                <Trigger Property="IsChecked" Value="True">
                    <Setter Property="Background" Value="{StaticResource CapCut.AccentColorBlue}"/>
                    <Setter Property="Foreground" Value="White"/>
                    <Setter Property="BorderBrush" Value="{StaticResource CapCut.AccentColorBlue}"/>
                </Trigger>
                <MultiTrigger>
                    <MultiTrigger.Conditions>
                        <Condition Property="IsChecked" Value="True"/>
                        <Condition Property="IsMouseOver" Value="True"/>
                    </MultiTrigger.Conditions>
                    <Setter Property="Background" Value="#FF6DA0FF"/>
                    <Setter Property="BorderBrush" Value="#FF6DA0FF"/>
                </MultiTrigger>
            </Style.Triggers>
        </Style>
        <Style x:Key="ModernCheckBoxStyle" TargetType="CheckBox">
            <Setter Property="FocusVisualStyle" Value="{x:Null}"/>
            <Setter Property="VerticalAlignment" Value="Center"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="Foreground" Value="{StaticResource CapCut.TextColor}"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="CheckBox">
                        <StackPanel Orientation="Horizontal">
                            <Border x:Name="checkBoxBorder" 
                                    Width="18" Height="18" 
                                    CornerRadius="4" 
                                    BorderBrush="{StaticResource CapCut.BorderColor}" 
                                    BorderThickness="1.5"
                                    Background="Transparent">
                                <Path x:Name="checkMark"  Data="M 4,9 L 8,13 L 14,5"  Stroke="White"  StrokeThickness="2"  Stretch="Uniform"  Visibility="Collapsed"/>
                            </Border>
                            <ContentPresenter Margin="8,0,0,0" VerticalAlignment="Center"/>
                        </StackPanel>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="checkBoxBorder" Property="BorderBrush" Value="White"/>
                            </Trigger>
                            <Trigger Property="IsChecked" Value="True">
                                <Setter TargetName="checkBoxBorder" Property="Background" Value="{StaticResource CapCut.AccentColorBlue}"/>
                                <Setter TargetName="checkBoxBorder" Property="BorderBrush" Value="{StaticResource CapCut.AccentColorBlue}"/>
                                <Setter TargetName="checkMark" Property="Visibility" Value="Visible"/>
                            </Trigger>
                            <Trigger Property="IsEnabled" Value="False">
                                <Setter Property="Opacity" Value="0.5"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
        <Style x:Key="ModernColorCanvasStyle" TargetType="xctk:ColorCanvas">
            <Setter Property="Foreground" Value="{StaticResource CapCut.TextColor}"/>
            <Setter Property="Background" Value="Transparent"/>
            <Style.Resources>
                <Style TargetType="TextBlock">
                    <Setter Property="Foreground" Value="{StaticResource CapCut.TextColor}"/>
                </Style>
                <Style TargetType="Label">
                    <Setter Property="Foreground" Value="{StaticResource CapCut.TextColor}"/>
                </Style>
            </Style.Resources>
        </Style>

        <Style x:Key="ModernColorPickerStyle" TargetType="xctk:ColorPicker">
            <Setter Property="BorderBrush" Value="{StaticResource CapCut.BorderColor}"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="Height" Value="30"/>
            <Setter Property="HorizontalAlignment" Value="Stretch"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="xctk:ColorPicker">
                        <Grid>
                            <ToggleButton x:Name="PART_ColorPickerToggleButton"
                                          IsChecked="{Binding IsOpen, RelativeSource={RelativeSource TemplatedParent}, Mode=TwoWay}">
                                <ToggleButton.Template>
                                    <ControlTemplate TargetType="ToggleButton">
                                        <Border BorderBrush="{TemplateBinding BorderBrush}"  BorderThickness="{TemplateBinding BorderThickness}"  Background="{StaticResource CapCut.PanelBackground}" CornerRadius="4">
                                            <Grid>
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition Width="*"/>
                                                    <ColumnDefinition Width="Auto"/>
                                                </Grid.ColumnDefinitions>
                                                <Border Grid.Column="0" Margin="4" Background="{Binding SelectedColor, RelativeSource={RelativeSource AncestorType=xctk:ColorPicker}, Converter={StaticResource ColorToBrushConverter}}" BorderBrush="{StaticResource CapCut.BorderColor}" BorderThickness="1" CornerRadius="2"/>
                                                <Path Grid.Column="1" Data="M 0 0 L 4 4 L 8 0 Z"  Stroke="{StaticResource CapCut.TextSecondaryColor}"  StrokeThickness="1"  VerticalAlignment="Center"  Margin="0,0,8,0"/>
                                            </Grid>
                                        </Border>
                                    </ControlTemplate>
                                </ToggleButton.Template>
                            </ToggleButton>

                            <Popup x:Name="PART_Popup"  IsOpen="{Binding IsChecked, ElementName=PART_ColorPickerToggleButton}" StaysOpen="False" AllowsTransparency="True" PopupAnimation="{DynamicResource {x:Static SystemParameters.ComboBoxPopupAnimationKey}}">
                                <Border Background="{StaticResource CapCut.PanelBackground}" BorderBrush="{StaticResource CapCut.BorderColor}" BorderThickness="1" CornerRadius="4" Padding="5">
                                    <xctk:ColorCanvas  Style="{StaticResource ModernColorCanvasStyle}" UsingAlphaChannel="{Binding UsingAlphaChannel, RelativeSource={RelativeSource TemplatedParent}}" SelectedColor="{Binding SelectedColor, RelativeSource={RelativeSource TemplatedParent}, Mode=TwoWay}" />
                                </Border>
                            </Popup>

                        </Grid>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
        <DataTemplate x:Key="StylePresetTemplate">
            <Button Width="30" Height="30" Margin="3" Padding="0" Click="PresetButton_Click" FocusVisualStyle="{x:Null}">
                <Button.Template>
                    <ControlTemplate TargetType="Button">
                        <Border x:Name="border" CornerRadius="6"  Background="{Binding Converter={StaticResource PresetBackgroundConverter}}"  BorderBrush="{StaticResource CapCut.BorderColor}" BorderThickness="1">
                            <Grid>
                                <Path Data="M 12,2 C 6.48,2 2,6.48 2,12 C 2,17.52 6.48,22 12,22 C 17.52,22 22,17.52 22,12 C 22,6.48 17.52,2 12,2 Z M 4,12 L 20,12"
                                      Stroke="{StaticResource CapCut.TextColor}" StrokeThickness="1.5"
                                      Width="24" Height="24" Stretch="Uniform" VerticalAlignment="Center" HorizontalAlignment="Center"
                                      Visibility="{Binding Converter={StaticResource IsStylePresetVisibleConverter}, ConverterParameter='Icon'}"/>
                                <TextBlock Text="Aa" FontSize="15" FontWeight="Bold"
                                           VerticalAlignment="Center" HorizontalAlignment="Center"                                         
                                           Foreground="{Binding FontColorHex, Converter={StaticResource HexStringToBrushConverter}}"
                                           Effect="{Binding Converter={StaticResource StyleStateToEffectConverter}}"
                                           Visibility="{Binding Converter={StaticResource IsStylePresetVisibleConverter}, ConverterParameter='Text'}"/>
                            </Grid>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="border" Property="BorderBrush" Value="White"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Button.Template>
            </Button>
        </DataTemplate>
        <Style x:Key="ModernToggleSwitchStyle" TargetType="ToggleButton">
            <Setter Property="FocusVisualStyle" Value="{x:Null}"/>
            <Setter Property="Width" Value="44"/>
            <Setter Property="Height" Value="24"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="ToggleButton">
                        <Grid>
                            <Border x:Name="BackgroundBorder" 
                            Background="{StaticResource CapCut.PanelBackground}"
                            BorderBrush="{StaticResource CapCut.BorderColor}"
                            BorderThickness="1.5"
                            CornerRadius="12"/>
                            <Border x:Name="Thumb"
                            HorizontalAlignment="Left"
                            Margin="3"
                            Width="18" Height="18"
                            Background="{StaticResource CapCut.TextColor}"
                            CornerRadius="9">
                                <Border.RenderTransform>
                                    <TranslateTransform x:Name="ThumbTransform" X="0"/>
                                </Border.RenderTransform>
                            </Border>
                        </Grid>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsChecked" Value="True">
                                <Setter TargetName="BackgroundBorder" Property="Background" Value="{StaticResource CapCut.AccentColorBlue}"/>
                                <Setter TargetName="BackgroundBorder" Property="BorderBrush" Value="{StaticResource CapCut.AccentColorBlue}"/>
                                <Trigger.EnterActions>
                                    <BeginStoryboard>
                                        <Storyboard>
                                            <DoubleAnimation Storyboard.TargetName="ThumbTransform"
                                                     Storyboard.TargetProperty="X"
                                                     To="20" Duration="0:0:0.2"/>
                                        </Storyboard>
                                    </BeginStoryboard>
                                </Trigger.EnterActions>
                                <Trigger.ExitActions>
                                    <BeginStoryboard>
                                        <Storyboard>
                                            <DoubleAnimation Storyboard.TargetName="ThumbTransform"
                                                     Storyboard.TargetProperty="X"
                                                     To="0" Duration="0:0:0.2"/>
                                        </Storyboard>
                                    </BeginStoryboard>
                                </Trigger.ExitActions>
                            </Trigger>
                            <Trigger Property="IsEnabled" Value="False">
                                <Setter Property="Opacity" Value="0.5"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
        <Style x:Key="TimelineContextMenuStyle" TargetType="ContextMenu">
            <Setter Property="Background" Value="{StaticResource CapCut.PanelBackground}"/>
            <Setter Property="BorderBrush" Value="{StaticResource CapCut.BorderColor}"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="Padding" Value="4"/>
            <Setter Property="HasDropShadow" Value="True"/>
            <Setter Property="OverridesDefaultStyle" Value="True"/>
            <Setter Property="SnapsToDevicePixels" Value="True"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="ContextMenu">
                        <Border Background="{TemplateBinding Background}"
                            BorderBrush="{TemplateBinding BorderBrush}"
                            BorderThickness="{TemplateBinding BorderThickness}"
                            CornerRadius="4">
                            <StackPanel IsItemsHost="True" KeyboardNavigation.DirectionalNavigation="Cycle"/>
                        </Border>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <Style x:Key="TimelineMenuItemStyle" TargetType="MenuItem">
            <Setter Property="OverridesDefaultStyle" Value="True"/>
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="Foreground" Value="{StaticResource CapCut.TextColor}"/>
            <Setter Property="Padding" Value="10,8"/>
            <Setter Property="Height" Value="32"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="MenuItem">
                        <Border x:Name="templateRoot" 
                            Background="{TemplateBinding Background}" 
                            Padding="{TemplateBinding Padding}"
                            CornerRadius="3">
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>
                                <ContentPresenter Grid.Column="0" ContentSource="Header" RecognizesAccessKey="True" VerticalAlignment="Center"/>
                                <TextBlock Grid.Column="1" Text="{TemplateBinding InputGestureText}" 
                                       Foreground="{StaticResource CapCut.TextSecondaryColor}" 
                                       VerticalAlignment="Center" Margin="15,0,0,0"/>
                            </Grid>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsHighlighted" Value="True">
                                <Setter Property="Background" Value="{StaticResource CapCut.LighterPanelBackground}"/>
                            </Trigger>
                            <Trigger Property="IsEnabled" Value="False">
                                <Setter Property="Foreground" Value="{StaticResource CapCut.TextSecondaryColor}"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
    </Window.Resources>
    <WindowChrome.WindowChrome>
        <WindowChrome CaptionHeight="32"
                  ResizeBorderThickness="8"
                  CornerRadius="0"
                  GlassFrameThickness="0"
                  UseAeroCaptionButtons="False" />
    </WindowChrome.WindowChrome>

    <Border BorderBrush="{StaticResource CapCut.BorderColor}" BorderThickness="1"
        Background="{StaticResource CapCut.WindowBackground}"
        TextElement.Foreground="{StaticResource CapCut.TextColor}">
        <Grid>
            <!-- Grid mới để chứa cả layout chính và panel kết quả -->

            <!-- Grid layout chính của toàn bộ window -->
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="32"/>
                    <RowDefinition Height="1*" MinHeight="250"/>
                    <RowDefinition Height="8"/>
                    <RowDefinition x:Name="TimelineRow" Height="1*" MinHeight="200"/>
                </Grid.RowDefinitions>

                <Grid Grid.Row="0" Background="{StaticResource CapCut.PanelBackground}" MouseLeftButtonDown="TitleBar_MouseLeftButtonDown">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>
                <TextBlock Grid.Column="1"
               Text="{Binding CurrentProject.ProjectName, FallbackValue='Loading Project...'}"
               HorizontalAlignment="Center"
               VerticalAlignment="Center"
               Foreground="{StaticResource CapCut.TextSecondaryColor}"
               FontSize="13"
               IsHitTestVisible="False"/>

                <Menu Grid.Column="0" Margin="10,0,0,0" WindowChrome.IsHitTestVisibleInChrome="True">
                    <MenuItem Header="_File">
                        <MenuItem Header="New project (Ctrl+N)" Click="NewProjectMenuItem_Click"/>
                        <MenuItem Header="Load project (Ctrl+L)" Click="LoadProjectMenuItem_Click"/>
                        <MenuItem x:Name="DeleteProjectMenuItem" Header="Del project (Ctrl+Del)" SubmenuOpened="DeleteProjectMenuItem_SubmenuOpened"/>
                    </MenuItem>
                    <MenuItem Header="_Tools" Click="MenuItem_Click">
                        <MenuItem Header="Tạo &amp; Dịch Phụ Đề Hàng Loạt" Click="BatchProcessMenuItem_Click"/>
                            <Separator/>
                            <MenuItem Header="Tải Video M3U8" x:Name="MenuM3u8Downloader" Click="MenuM3u8Downloader_Click"/>
                        <Separator/>
                        <MenuItem Header="Tải Font Mặc Định" Click="DownloadDefaultFonts_Click"/>
                            <Separator/>
                            <MenuItem Header="Import Font từ Thư mục" Click="ImportFonts_Click"/>
                    </MenuItem>
                    <MenuItem Header="_Cài đặt">
                        <MenuItem Header="Chế độ OCR">
                            <MenuItem x:Name="OcrModeGoogleCloudMenuItem" Header="Google Cloud OCR" IsCheckable="True" Click="OcrMode_Click"/>
                            <MenuItem x:Name="OcrModeGeminiApiMenuItem" Header="Gemini API OCR" IsCheckable="True" Click="OcrMode_Click"/>
                        </MenuItem>
                        <Separator/>
                        <MenuItem x:Name="SettingsApiMenuItem" Header="Cài đặt AIOSubPhim, API, OCR..." Click="SettingsApiMenuItem_Click"/>
                    </MenuItem>
                    <MenuItem Header="_Phím tắt" Click="ShowShortcuts_Click"/>
                    <MenuItem x:Name="PresetMenuItem" Header="_Preset">
                    </MenuItem>

                </Menu>

                <StackPanel Grid.Column="2" Orientation="Horizontal" HorizontalAlignment="Right" WindowChrome.IsHitTestVisibleInChrome="True">
                    <Button x:Name="ExportButton"
                            Content="Xuất"
                            Margin="0,0,10,0"
                            Style="{StaticResource PrimaryActionButtonStyle}"
                            Height="28" Padding="20,5"
                            Click="ExportButton_Click" Width="70"/>
                    <Button x:Name="MinimizeButton" Content="—" Style="{StaticResource WindowButtonStyle}" Click="MinimizeButton_Click"/>
                    <Button x:Name="MaximizeButton" Content="☐" Style="{StaticResource WindowButtonStyle}" Click="MaximizeButton_Click"/>
                    <Button x:Name="CloseButton" Content="✕" Style="{StaticResource WindowCloseButtonStyle}" Click="CloseButton_Click"/>
                </StackPanel>
            </Grid>
            <Grid Grid.Row="1" x:Name="MainContentGrid">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="1.5*" MinWidth="400"/>
                    <ColumnDefinition Width="8"/>
                    <ColumnDefinition Width="2*" MinWidth="300"/>
                    <ColumnDefinition Width="8"/>
                    <ColumnDefinition Width="1.2*" MinWidth="350"/>
                </Grid.ColumnDefinitions>
                <Grid Grid.Column="0" Margin="8,8,0,8" Background="{StaticResource CapCut.PanelBackground}">
                    <DockPanel>
                        <Border DockPanel.Dock="Top" BorderBrush="{StaticResource CapCut.BorderColor}" BorderThickness="0,0,0,1">
                            <StackPanel Orientation="Horizontal">
                                <ToggleButton x:Name="MediaTab" Content="Tệp"  Style="{StaticResource MainTabStyle}" IsChecked="True" Checked="Tab_Checked"/>
                                <ToggleButton x:Name="SubtitleTab" Content="Phụ đề" Style="{StaticResource MainTabStyle}" Checked="Tab_Checked"/>
                                <ToggleButton x:Name="TranslateTab" Content="Dịch"  Style="{StaticResource MainTabStyle}" Checked="Tab_Checked"/>
                                <ToggleButton x:Name="TtsTab" Content="Text to Speech" Style="{StaticResource MainTabStyle}" IsEnabled="True" Checked="Tab_Checked"/>
                            </StackPanel>
                        </Border>
                        <Border DockPanel.Dock="Bottom" BorderBrush="{StaticResource CapCut.BorderColor}" BorderThickness="0,1,0,0" Padding="15,0" MinHeight="60">
                            <Grid>
                                <Grid Visibility="{Binding IsChecked, ElementName=SubtitleTab, Converter={StaticResource BooleanToVisibilityConverter}}">
                                    <CheckBox Content="Xóa phụ đề hiện tại" VerticalAlignment="Center" HorizontalAlignment="Left" Foreground="{StaticResource CapCut.TextSecondaryColor}" IsEnabled="False"/>
                                    <StackPanel x:Name="DefaultOcrButtonsPanel" Orientation="Horizontal" HorizontalAlignment="Right" Visibility="{Binding IsChecked, ElementName=ModeOcrRadio, Converter={StaticResource BooleanToVisibilityConverter}}">
                                        <Button x:Name="RunVSFButton" Content="Tìm Phụ Đề" Margin="0,0,5,0" Style="{StaticResource PrimaryActionButtonStyle}" Click="RunVSFButton_Click"/>
                                        <Button x:Name="StartButton" Content="OCR Lại" Margin="0,0,5,0" Style="{StaticResource PrimaryActionButtonStyle}" Click="StartButton_Click"/>
                                        <Button x:Name="AutomaticButton" Content="Tự động" Style="{StaticResource PrimaryActionButtonStyle}" Click="AutomaticButton_Click"/>
                                    </StackPanel>
                                    <Button x:Name="StartBatchSubtitleCreationButton" 
            Content="Bắt đầu Tạo Phụ đề Hàng loạt" 
            HorizontalAlignment="Right"
            Style="{StaticResource PrimaryActionButtonStyle}" 
            Click="StartBatchSubtitleCreationButton_Click"
            Visibility="Collapsed"/>
                                    <StackPanel Orientation="Horizontal" HorizontalAlignment="Right" Visibility="{Binding IsChecked, ElementName=ModeSpeechToTextRadio, Converter={StaticResource BooleanToVisibilityConverter}}">
                                        <Button x:Name="RunWhisperButton" Content="Tạo"  Style="{StaticResource PrimaryActionButtonStyle}" Click="RunWhisperButton_Click"/>
                                    </StackPanel>
                                </Grid>
                                <Grid Visibility="{Binding IsChecked, ElementName=TranslateTab, Converter={StaticResource BooleanToVisibilityConverter}}">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="Auto"/>
                                        <ColumnDefinition Width="*"/>
                                    </Grid.ColumnDefinitions>

                                    <!-- Left side: ComboBoxes -->
                                    <StackPanel Grid.Column="0" Orientation="Horizontal" VerticalAlignment="Center">
                                        <StackPanel Orientation="Vertical">
                                            <StackPanel Orientation="Horizontal">
                                                <ComboBox x:Name="SrtApiProviderComboBox" Margin="0,2,5,5" SelectionChanged="SrtApiProvider_SelectionChanged" MinWidth="120" VerticalContentAlignment="Center" ToolTip="API Dịch"/>
                                                <ComboBox x:Name="SrtTranslateModelComboBox" Margin="0,2,5,5" SelectionChanged="SrtTranslateModel_Changed" MinWidth="150" VerticalContentAlignment="Center" ToolTip="Model"/>
                                            </StackPanel>
                                            <StackPanel Orientation="Horizontal">
                                                <ComboBox x:Name="SrtTargetLanguageComboBox" Margin="0,2,5,5" SelectionChanged="SrtTargetLanguage_Changed" IsEnabled="{Binding IsChecked, ElementName=EnableCustomPromptCheckBox, Converter={StaticResource InvertBooleanConverter}}" MinWidth="120" VerticalContentAlignment="Center" ToolTip="Ngôn ngữ đích"/>
                                                <ComboBox x:Name="SrtGenreComboBox" Margin="0,2,5,5" SelectionChanged="SrtGenre_SelectionChanged" IsEnabled="{Binding IsChecked, ElementName=EnableCustomPromptCheckBox, Converter={StaticResource InvertBooleanConverter}}" MinWidth="150" VerticalContentAlignment="Center" ToolTip="Thể loại"/>
                                            </StackPanel>
                                        </StackPanel>
                                    </StackPanel>

                                    <!-- Right side: Buttons -->
                                    <StackPanel Grid.Column="1" Orientation="Horizontal" HorizontalAlignment="Right" VerticalAlignment="Center">
                                        <Button x:Name="MergeDuplicateSrtOriginalsButton" Content="Gộp Dòng" Margin="0,0,5,0" Style="{StaticResource PrimaryActionButtonStyle}" Click="MergeDuplicateSrtOriginalsButton_Click"/>
                                        <Button x:Name="ExportTranslatedSrtButton" Content="Xuất File" Margin="0,0,5,0" Style="{StaticResource PrimaryActionButtonStyle}" Click="ExportTranslatedSrtButton_Click"/>
                                        <Button x:Name="TranslateSrtButton" Content="Dịch" Style="{StaticResource PrimaryActionButtonStyle}" Click="TranslateSrtButton_Click"/>
                                    </StackPanel>
                                </Grid>
                                <Grid x:Name="TtsPlayerActionPanel" Visibility="{Binding IsChecked, ElementName=TtsTab, Converter={StaticResource BooleanToVisibilityConverter}}">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="Auto"/>
                                        <ColumnDefinition Width="Auto"/>
                                    </Grid.ColumnDefinitions>
                                    <StackPanel x:Name="TtsPlaybackControlsPanel" Grid.Column="0" Orientation="Horizontal" Visibility="Collapsed">
                                        <Grid x:Name="TtsPlayerPanel" MinWidth="200">
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="Auto"/>
                                                <ColumnDefinition Width="*"/>
                                                <ColumnDefinition Width="Auto"/>
                                            </Grid.ColumnDefinitions>
                                            <Button x:Name="TtsPlayPauseButton" Grid.Column="0" Content="" FontFamily="Segoe MDL2 Assets, Segoe UI Symbol, Arial" FontSize="16" Style="{StaticResource PlayerControlButtonStyle}" IsEnabled="False" Click="TtsPlayPauseButton_Click"/>
                                            <Slider x:Name="TtsProgressSlider" Grid.Column="1" VerticalAlignment="Center" Margin="5,0" IsEnabled="False" Thumb.DragStarted="TtsProgressSlider_DragStarted" Thumb.DragCompleted="TtsProgressSlider_DragCompleted"/>
                                            <TextBlock x:Name="TtsTimeDisplay" Grid.Column="2" Text="00:00 / 00:00" VerticalAlignment="Center" Foreground="{StaticResource CapCut.TextSecondaryColor}" FontSize="11" FontFamily="Consolas"/>
                                        </Grid>
                                        <Button x:Name="DownloadTtsButton" VerticalAlignment="Center" Margin="10,0,0,0"
                Style="{StaticResource PlayerControlButtonStyle}" Click="DownloadTtsButton_Click">
                                            <StackPanel Orientation="Horizontal">
                                                <TextBlock Text="" FontFamily="Segoe MDL2 Assets, Segoe UI Symbol, Arial" FontSize="14" VerticalAlignment="Center"/>
                                                <TextBlock Text="Tải về" Margin="5,0,0,0" VerticalAlignment="Center"/>
                                            </StackPanel>
                                        </Button>
                                    </StackPanel>
                                    <Grid Grid.Column="1" VerticalAlignment="Center" Margin="0,0,15,0">
                                        <TextBlock x:Name="TtsCharCountTextBlock" 
                               Foreground="{StaticResource CapCut.TextSecondaryColor}" Text="0 / 500"
                               Visibility="{Binding IsChecked, ElementName=TtsModeLongTextRadio, Converter={StaticResource BooleanToVisibilityConverter}}"/>
                                        <TextBlock Text="" Foreground="{StaticResource CapCut.TextSecondaryColor}"
                               Visibility="{Binding IsChecked, ElementName=TtsModeVoiceSubRadio, Converter={StaticResource BooleanToVisibilityConverter}}"/>
                                    </Grid>
                                    <Grid Grid.Column="2">
                                        <Button x:Name="GenerateTtsButton" Content="Tạo Âm Thanh" Style="{StaticResource PrimaryActionButtonStyle}" Click="GenerateTtsButton_Click"
                            Visibility="{Binding IsChecked, ElementName=TtsModeLongTextRadio, Converter={StaticResource BooleanToVisibilityConverter}}"/>
                                        <Button x:Name="GenerateVoiceSubButton" Content="Tạo Voice Sub" Style="{StaticResource PrimaryActionButtonStyle}" Click="GenerateVoiceSubButton_Click"
                            Visibility="{Binding IsChecked, ElementName=TtsModeVoiceSubRadio, Converter={StaticResource BooleanToVisibilityConverter}}"/>
                                    </Grid>
                                </Grid>
                            </Grid>
                        </Border>
                        <Grid>
                            <Grid x:Name="MediaPanel" Visibility="{Binding IsChecked, ElementName=MediaTab, Converter={StaticResource BooleanToVisibilityConverter}}"
      AllowDrop="True" Drop="MediaPanel_Drop" DragOver="MediaPanel_DragOver">
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="*"/>
                                </Grid.RowDefinitions>
                                <Border Grid.Row="0" Padding="10" BorderBrush="{StaticResource CapCut.BorderColor}" BorderThickness="0,0,0,1">
                                    <StackPanel Orientation="Horizontal">
                                        <Button x:Name="ImportMediaButton" HorizontalAlignment="Left" Click="ImportMediaButton_Click">
                                            <StackPanel Orientation="Horizontal">
                                                <TextBlock FontFamily="Segoe MDL2 Assets, Segoe UI Symbol, Arial" FontSize="14" VerticalAlignment="Center"/>
                                                <TextBlock Text="Nhập Media" Margin="8,0,0,0" VerticalAlignment="Center"/>
                                            </StackPanel>
                                        </Button>
                                        <Button x:Name="ImportSubtitleButton" HorizontalAlignment="Left" Click="ImportSubtitleButton_Click" Margin="10,0,0,0">
                                            <StackPanel Orientation="Horizontal">
                                                <TextBlock Text="" FontFamily="Segoe MDL2 Assets, Segoe UI Symbol, Arial" FontSize="14" VerticalAlignment="Center"/>
                                                <TextBlock Text="Nhập Phụ đề" Margin="8,0,0,0" VerticalAlignment="Center"/>
                                            </StackPanel>
                                        </Button>
                                        <Button x:Name="AddTextClipButton" HorizontalAlignment="Left" Click="AddTextClip_Click" Margin="10,0,0,0">
                                            <StackPanel Orientation="Horizontal">
                                                <TextBlock Text="" FontFamily="Segoe MDL2 Assets, Segoe UI Symbol, Arial" FontSize="14" VerticalAlignment="Center"/>
                                                <TextBlock Text="Thêm Văn bản" Margin="8,0,0,0" VerticalAlignment="Center"/>
                                            </StackPanel>
                                        </Button>
                                        <Button x:Name="ImportVoicedSubtitleButton" HorizontalAlignment="Left" Click="ImportVoicedSubtitleButton_Click" Margin="10,0,0,0">
                                            <StackPanel Orientation="Horizontal">
                                                <TextBlock Text="" FontFamily="Segoe MDL2 Assets, Segoe UI Symbol, Arial" FontSize="14" VerticalAlignment="Center"/>
                                                <TextBlock Text="Import Voice" Margin="8,0,0,0" VerticalAlignment="Center"/>
                                            </StackPanel>
                                        </Button>
                                        <Button x:Name="BlurRegionButton"
        Margin="8,0,0,0"
        Content="Vùng Mờ"
        Click="BlurRegionButton_Click"/>

                                        <!-- Popup (không phải MessageBox) -->
                                        <Popup x:Name="BlurOptionsPopup"
       Placement="Bottom"
       PlacementTarget="{Binding ElementName=BlurRegionButton}"
       StaysOpen="False"
       AllowsTransparency="True"
       IsOpen="{Binding IsBlurPopupOpen}">
                                            <Border Padding="14" CornerRadius="8" Background="#DD1E1E1E">
                                                <StackPanel>
                                                    <TextBlock Text="Tuỳ chọn làm mờ" FontWeight="Bold" Margin="0,0,0,8"/>
                                                    <RadioButton x:Name="BlurBySubtitleRadio" Content="Làm mờ theo phụ đề" IsChecked="True"/>
                                                    <RadioButton x:Name="BlurAllTimeRadio"    Content="Làm mờ toàn thời gian"/>
                                                    <StackPanel Orientation="Horizontal" HorizontalAlignment="Right" Margin="0,10,0,0">
                                                        <Button Content="Tắt &amp; Đóng"  Margin="0,0,8,0" Click="BlurOptionsCancelButton_Click" ToolTip="Tắt tính năng làm mờ và đóng cửa sổ này"/>
                                                        <Button Content="Áp dụng" Style="{StaticResource PrimaryActionButtonStyle}" Click="BlurOptionsApplyButton_Click"/>
                                                    </StackPanel>
                                                </StackPanel>
                                            </Border>
                                        </Popup>

                                    </StackPanel>
                                </Border>
                                <ScrollViewer Grid.Row="1" VerticalScrollBarVisibility="Auto" HorizontalScrollBarVisibility="Disabled" Padding="5"
              x:Name="MediaBinScrollViewer"
              PreviewKeyDown="MediaBin_PreviewKeyDown"
              PreviewMouseWheel="MediaBinScrollViewer_PreviewMouseWheel">
                                    <StackPanel Orientation="Vertical">
                                        <Border BorderBrush="{StaticResource CapCut.BorderColor}" BorderThickness="0,0,0,1" Margin="5,5,5,10"
                                                Visibility="{Binding Items.Count, ElementName=SubtitleBinControl, Converter={StaticResource BooleanToVisibilityConverter}}">
                                            <TextBlock Text="Phụ đề" Foreground="{StaticResource CapCut.TextSecondaryColor}" FontSize="12" Margin="0,0,0,5"/>
                                        </Border>
                                        <ItemsControl x:Name="SubtitleBinControl" ItemsSource="{Binding SubtitleAssets}">
                                            <ItemsControl.ItemsPanel>
                                                <ItemsPanelTemplate>
                                                    <WrapPanel/>
                                                </ItemsPanelTemplate>
                                            </ItemsControl.ItemsPanel>
                                            <ItemsControl.ItemTemplate>
                                                <DataTemplate>
                                                    <!-- Kích thước đã được điều chỉnh theo yêu cầu -->
                                                    <Border Width="60" Height="70" Margin="5" Background="{StaticResource CapCut.LighterPanelBackground}" CornerRadius="4"  Cursor="Hand" PreviewMouseLeftButtonDown="MediaAsset_PreviewMouseLeftButtonDown" PreviewMouseMove="MediaAsset_PreviewMouseMove">
                                                        <Border.ContextMenu>
                                                            <ContextMenu Style="{StaticResource TimelineContextMenuStyle}">
                                                                <MenuItem Header="Dịch phụ đề" Click="TranslateSubtitleFromMediaBin_Click" Style="{StaticResource MediaBinMenuItemStyle}" />
                                                                <MenuItem Header="Xoá" Click="DeleteMediaBinItem_Click" Style="{StaticResource MediaBinMenuItemStyle}" />
                                                            </ContextMenu>
                                                        </Border.ContextMenu>
                                                        <Border.Style>
                                                            <Style TargetType="Border">
                                                                <Setter Property="BorderBrush" Value="Transparent"/>
                                                                <Setter Property="BorderThickness" Value="2"/>
                                                                <Style.Triggers>
                                                                    <DataTrigger Binding="{Binding IsSelected}" Value="True">
                                                                        <Setter Property="BorderBrush" Value="{StaticResource CapCut.AccentColorBlue}"/>
                                                                    </DataTrigger>
                                                                </Style.Triggers>
                                                            </Style>
                                                        </Border.Style>
                                                        <Grid>
                                                            <Grid.RowDefinitions>
                                                                <RowDefinition Height="*"/>
                                                                <RowDefinition Height="Auto"/>
                                                            </Grid.RowDefinitions>

                                                            <Border Grid.Row="0" Background="#FF008282" Margin="5,5,5,0" CornerRadius="3">
                                                                <Grid>
                                                                    <!-- Chữ T đã được thu nhỏ -->
                                                                    <TextBlock Text="T" FontFamily="Times New Roman" FontWeight="Bold" FontSize="32" Foreground="#B3FFFFFF" HorizontalAlignment="Center" VerticalAlignment="Center" Margin="0,-2,0,0"/>
                                                                    <!-- Nhãn SRT đã được điều chỉnh -->
                                                                    <Border Background="#FF00A6A6" VerticalAlignment="Bottom" HorizontalAlignment="Center" Padding="4,1" CornerRadius="2" Margin="0,0,0,5">
                                                                        <TextBlock Text="{Binding FileExtension, Converter={StaticResource ToUpperConverter}}" Foreground="White" FontWeight="SemiBold" FontSize="9"/>
                                                                    </Border>
                                                                </Grid>
                                                            </Border>

                                                            <!-- Tên file đã được điều chỉnh -->
                                                            <TextBlock Grid.Row="1" Text="{Binding FileName, Converter={StaticResource TruncatedFileNameConverter}}" FontSize="10" Foreground="{StaticResource CapCut.TextSecondaryColor}" HorizontalAlignment="Center" TextAlignment="Center" Margin="2" ToolTip="{Binding FileName}"/>

                                                            <!-- Nút Thêm vào Timeline (giữ nguyên vị trí góc trái trên cùng) -->
                                                            <Button Width="19" Height="19"                           
            HorizontalAlignment="Left" VerticalAlignment="Top" 
            Margin="5,5,0,0"
            Click="AddToTimelineButton_Click" 
            ToolTip="Thêm vào timeline">
                                                                <Button.Template>
                                                                    <ControlTemplate TargetType="Button">
                                                                        <Grid>
                                                                            <Ellipse Fill="#FF00A6A6" Opacity="0.8"/>
                                                                            <TextBlock Text="+" Foreground="White" 
                       FontSize="15" FontWeight="SemiBold" 
                       HorizontalAlignment="Center" VerticalAlignment="Center" 
                       Margin="0,-1,0,0"/>
                                                                        </Grid>
                                                                    </ControlTemplate>
                                                                </Button.Template>
                                                            </Button>
                                                        </Grid>
                                                    </Border>
                                                </DataTemplate>
                                            </ItemsControl.ItemTemplate>
                                        </ItemsControl>
                                        <Border BorderBrush="{StaticResource CapCut.BorderColor}" BorderThickness="0,0,0,1" Margin="5,15,5,10"
                                                Visibility="{Binding Items.Count, ElementName=VideoImageBinControl, Converter={StaticResource BooleanToVisibilityConverter}}">
                                            <TextBlock Text="Video &amp; Ảnh" Foreground="{StaticResource CapCut.TextSecondaryColor}" FontSize="12" Margin="0,0,0,5"/>
                                        </Border>
                                        <ItemsControl x:Name="VideoImageBinControl" ItemsSource="{Binding VideoImageAssets}">
                                            <ItemsControl.ItemsPanel>
                                                <ItemsPanelTemplate>
                                                    <WrapPanel/>
                                                </ItemsPanelTemplate>
                                            </ItemsControl.ItemsPanel>
                                            <ItemsControl.ItemTemplate>
                                                <DataTemplate>
                                                    <Border Width="100" Height="80" Margin="5" Background="{StaticResource CapCut.LighterPanelBackground}" CornerRadius="2"  Cursor="Hand" PreviewMouseLeftButtonDown="MediaAsset_PreviewMouseLeftButtonDown" PreviewMouseMove="MediaAsset_PreviewMouseMove">
                                                        <Border.ContextMenu>
                                                            <ContextMenu Style="{StaticResource TimelineContextMenuStyle}">
                                                                <MenuItem Header="Tạo phụ đề" Click="CreateSubtitlesMenuItem_Click" FontWeight="SemiBold">
                                                                    <MenuItem.Style>
                                                                        <Style TargetType="MenuItem" BasedOn="{StaticResource MediaBinMenuItemStyle}">
                                                                            <Setter Property="Visibility" Value="Collapsed"/>
                                                                            <Style.Triggers>
                                                                                <DataTrigger Binding="{Binding Type}" Value="Video">
                                                                                    <Setter Property="Visibility" Value="Visible"/>
                                                                                </DataTrigger>
                                                                            </Style.Triggers>
                                                                        </Style>
                                                                    </MenuItem.Style>
                                                                </MenuItem>
                                                                <MenuItem Header="Xoá" Click="DeleteMediaBinItem_Click" Style="{StaticResource MediaBinMenuItemStyle}" />
                                                            </ContextMenu>
                                                        </Border.ContextMenu>
                                                        <Border.Style>
                                                            <Style TargetType="Border">
                                                                <Setter Property="BorderBrush" Value="Transparent"/>
                                                                <Setter Property="BorderThickness" Value="2"/>
                                                                <Style.Triggers>
                                                                    <DataTrigger Binding="{Binding IsSelected}" Value="True">
                                                                        <Setter Property="BorderBrush" Value="{StaticResource CapCut.AccentColorBlue}"/>
                                                                    </DataTrigger>
                                                                </Style.Triggers>
                                                            </Style>
                                                        </Border.Style>
                                                        <Grid>
                                                            <Grid.RowDefinitions>
                                                                <RowDefinition Height="*"/>
                                                                <RowDefinition Height="Auto"/>
                                                            </Grid.RowDefinitions>
                                                            <Image Grid.Row="0" Source="{Binding ThumbnailSource}" Stretch="UniformToFill"/>
                                                            <Border Grid.Row="0" Background="#80000000" VerticalAlignment="Bottom" Padding="3"
    Visibility="{Binding Type, ConverterParameter=Video, Converter={StaticResource EnumToVisibilityConverter}}">
                                                                <TextBlock Text="{Binding Duration, StringFormat={}{0:mm\\:ss}}" Foreground="White" FontSize="10" HorizontalAlignment="Right"/>
                                                            </Border>
                                                            <TextBlock Grid.Row="1" Text="{Binding FileName, Converter={StaticResource TruncatedFileNameConverter}}" FontSize="11" TextTrimming="CharacterEllipsis" Foreground="{StaticResource CapCut.TextSecondaryColor}" HorizontalAlignment="Center" TextAlignment="Center" Margin="5" ToolTip="{Binding FileName}"/>

                                                            <Button Width="19" Height="19"                           
HorizontalAlignment="Left" VerticalAlignment="Top" 
Margin="5,5,0,0"
Click="AddToTimelineButton_Click" 
ToolTip="Thêm vào timeline">
                                                                <Button.Template>
                                                                    <ControlTemplate TargetType="Button">
                                                                        <Grid>
                                                                            <Ellipse Fill="#FF00A6A6" Opacity="0.8"/>
                                                                            <TextBlock Text="+" Foreground="White" 
                       FontSize="18" FontWeight="SemiBold" 
                       HorizontalAlignment="Center" VerticalAlignment="Center" 
                       Margin="0,-1,0,0"/>
                                                                        </Grid>
                                                                    </ControlTemplate>
                                                                </Button.Template>
                                                            </Button>
                                                        </Grid>
                                                    </Border>
                                                </DataTemplate>
                                            </ItemsControl.ItemTemplate>
                                        </ItemsControl>
                                        <Border BorderBrush="{StaticResource CapCut.BorderColor}" BorderThickness="0,0,0,1" Margin="5,15,5,10"
                                                Visibility="{Binding Items.Count, ElementName=AudioBinControl, Converter={StaticResource BooleanToVisibilityConverter}}">
                                            <TextBlock Text="Âm thanh" Foreground="{StaticResource CapCut.TextSecondaryColor}" FontSize="12" Margin="0,0,0,5"/>
                                        </Border>
                                        <ItemsControl x:Name="AudioBinControl" ItemsSource="{Binding AudioAssets}">
                                            <ItemsControl.ItemsPanel>
                                                <ItemsPanelTemplate>
                                                    <WrapPanel/>
                                                </ItemsPanelTemplate>
                                            </ItemsControl.ItemsPanel>
                                            <ItemsControl.ItemTemplate>
                                                <DataTemplate>
                                                    <Border Width="100" Height="80" Margin="5" Background="{StaticResource CapCut.LighterPanelBackground}" CornerRadius="4"  Cursor="Hand" PreviewMouseLeftButtonDown="MediaAsset_PreviewMouseLeftButtonDown" PreviewMouseMove="MediaAsset_PreviewMouseMove">
                                                        <Border.ContextMenu>
                                                            <ContextMenu Style="{StaticResource TimelineContextMenuStyle}">
                                                                <MenuItem Header="Xoá" Click="DeleteMediaBinItem_Click" Style="{StaticResource MediaBinMenuItemStyle}" />
                                                            </ContextMenu>
                                                        </Border.ContextMenu>
                                                        <Border.Style>
                                                            <Style TargetType="Border">
                                                                <Setter Property="BorderBrush" Value="Transparent"/>
                                                                <Setter Property="BorderThickness" Value="2"/>
                                                                <Style.Triggers>
                                                                    <DataTrigger Binding="{Binding IsSelected}" Value="True">
                                                                        <Setter Property="BorderBrush" Value="{StaticResource CapCut.AccentColorBlue}"/>
                                                                    </DataTrigger>
                                                                </Style.Triggers>
                                                            </Style>
                                                        </Border.Style>
                                                        <Grid>
                                                            <Grid.RowDefinitions>
                                                                <RowDefinition Height="*"/>
                                                                <RowDefinition Height="Auto"/>
                                                            </Grid.RowDefinitions>
                                                            <Grid Grid.Row="0" Background="#FF3A3B3D">
                                                                <TextBlock Text="{Binding FileExtension, Converter={StaticResource ToUpperConverter}}" FontSize="24" FontWeight="Bold" Foreground="#FFA9AAAB" HorizontalAlignment="Center" VerticalAlignment="Center" Opacity="0.8"/>
                                                            </Grid>
                                                            <Border Grid.Row="0" Background="#80000000" VerticalAlignment="Bottom" Padding="3">
                                                                <TextBlock Text="{Binding Duration, StringFormat={}{0:mm\\:ss}}" Foreground="White" FontSize="10" HorizontalAlignment="Right"/>
                                                            </Border>
                                                            <TextBlock Grid.Row="1" Text="{Binding FileName, Converter={StaticResource TruncatedFileNameConverter}}" FontSize="11" TextTrimming="CharacterEllipsis" Foreground="{StaticResource CapCut.TextSecondaryColor}" HorizontalAlignment="Center" TextAlignment="Center" Margin="5" ToolTip="{Binding FileName}"/>

                                                            <Button Width="19" Height="19"                           
HorizontalAlignment="Left" VerticalAlignment="Top" 
Margin="5,5,0,0"
Click="AddToTimelineButton_Click" 
ToolTip="Thêm vào timeline">
                                                                <Button.Template>
                                                                    <ControlTemplate TargetType="Button">
                                                                        <Grid>
                                                                            <Ellipse Fill="#FF00A6A6" Opacity="0.8"/>
                                                                            <TextBlock Text="+" Foreground="White" 
                       FontSize="18" FontWeight="SemiBold" 
                       HorizontalAlignment="Center" VerticalAlignment="Center" 
                       Margin="0,-1,0,0"/>
                                                                        </Grid>
                                                                    </ControlTemplate>
                                                                </Button.Template>
                                                            </Button>
                                                        </Grid>
                                                    </Border>
                                                </DataTemplate>
                                            </ItemsControl.ItemTemplate>
                                        </ItemsControl>
                                    </StackPanel>
                                </ScrollViewer>
                            </Grid>
                            <Grid x:Name="SubtitlePanel" Visibility="{Binding IsChecked, ElementName=SubtitleTab, Converter={StaticResource BooleanToVisibilityConverter}}">

                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="Auto" MinWidth="150"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>
                                <Border Grid.Column="0" BorderBrush="{StaticResource CapCut.BorderColor}" BorderThickness="0,0,1,0">
                                    <StackPanel Orientation="Vertical" Margin="5,10">
                                        <RadioButton x:Name="ModeOcrRadio" Content="Phụ đề Hardsub" GroupName="ProcessingMode" Style="{StaticResource LeftNavRadioButtonStyle}" IsChecked="True" Checked="ProcessingMode_Changed"/>
                                        <RadioButton x:Name="ModeSpeechToTextRadio" Content="Speech-to-text" GroupName="ProcessingMode" Style="{StaticResource LeftNavRadioButtonStyle}" Checked="ProcessingMode_Changed"/>
                                    </StackPanel>
                                </Border>
                                <ScrollViewer Grid.Column="1" VerticalScrollBarVisibility="Auto">
                                    <StackPanel>
                                        <StackPanel x:Name="OcrSettingsPanel" Visibility="{Binding IsChecked, ElementName=ModeOcrRadio, Converter={StaticResource BooleanToVisibilityConverter}}" Margin="15,0,10,0">
                                            <GroupBox Header="Mode OCR" Margin="0,5,0,10">
                                                <StackPanel Orientation="Horizontal" Margin="5">
                                                    <RadioButton x:Name="OcrProviderGoogleCloudRadio" Content="AIO OCR (siêu nhanh)" GroupName="OcrProviderGroup" IsChecked="True" Margin="0,0,15,0" Checked="OcrProvider_Changed"/>
                                                    <RadioButton x:Name="OcrProviderGeminiApiRadio" Content="Gemini OCR" GroupName="OcrProviderGroup"  Checked="OcrProvider_Changed"/>
                                                </StackPanel>
                                            </GroupBox>
                                            <TextBlock Text="Số luồng xử lý (AIOSubphim)" Style="{StaticResource SectionHeaderStyle}"/>
                                            <Grid Margin="5,0,0,10">
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition Width="*"/>
                                                    <ColumnDefinition Width="Auto"/>
                                                </Grid.ColumnDefinitions>
                                                <ComboBox x:Name="VsfThreadComboBox"
              Grid.Column="0"
              VerticalAlignment="Center"
              Padding="8,4"
              BorderBrush="{StaticResource CapCut.BorderColor}"
              Foreground="{StaticResource CapCut.TextColor}"
              SelectionChanged="VsfThreadComboBox_SelectionChanged">
                                                    <ComboBoxItem Content="Tự động" Tag="-1"/>
                                                    <ComboBoxItem Content="2 luồng" Tag="2"/>
                                                    <ComboBoxItem Content="4 luồng" Tag="4"/>
                                                    <ComboBoxItem Content="6 luồng" Tag="6"/>
                                                    <ComboBoxItem Content="8 luồng" Tag="8"/>
                                                    <ComboBoxItem Content="12 luồng" Tag="12"/>
                                                    <ComboBoxItem Content="16 luồng" Tag="16"/>
                                                </ComboBox>
                                                <TextBlock x:Name="VsfThreadNoteText"
               Grid.Column="1"
               TextWrapping="Wrap"
               FontStyle="Italic"
               Foreground="{StaticResource CapCut.TextSecondaryColor}"
               Margin="10,0,0,0"
               VerticalAlignment="Center"
               Text="Tự động tính theo CPU."/>
                                            </Grid>
                                            <TextBlock Text="Tạo Phụ Đề" Style="{StaticResource SectionHeaderStyle}"/>
                                            <StackPanel Orientation="Horizontal" Margin="5">
                                                <RadioButton x:Name="VsfModeSearchOnlyRadio" Content="Tìm Kiếm nhanh" GroupName="VsfProcessingModeGroup" IsChecked="True" Margin="0,0,15,0" Checked="VsfMode_CheckedChanged"/>
                                                <RadioButton x:Name="VsfModeCleanRadio" Content="Làm sạch (Chậm)" GroupName="VsfProcessingModeGroup"  Checked="VsfMode_CheckedChanged"/>
                                            </StackPanel>
                                            <Separator Margin="0,10"/>
                                            <TextBlock Text="Đường dẫn" Style="{StaticResource SectionHeaderStyle}"/>
                                            <Label Content="File video:"/>
                                            <TextBox x:Name="VideoEntry" IsReadOnly="True" Margin="0,0,0,5"/>
                                            <Label Content="Thư mục ảnh (AIOSubPhim Output):"/>
                                            <TextBox x:Name="ImagesEntry" Margin="0,0,0,5"/>
                                            <Label Content="Lưu file sub tại:"/>
                                            <TextBox x:Name="SubtitleEntry" Margin="0,0,0,5"/>
                                            <TextBlock x:Name="resultsTextBlock" Margin="0,10" TextWrapping="Wrap" Foreground="{StaticResource CapCut.TextSecondaryColor}" Text="Top: 0.0000 | Bottom: 0.0000 | Left: 0.0000 | Right: 0.0000"/>
                                            <Separator Margin="0,10"/>
                                            <TextBlock Text="Cài đặt Thời gian" Style="{StaticResource SectionHeaderStyle}"/>
                                            <CheckBox x:Name="EnableStartTimeCheckBox" Content="Bắt đầu:" VerticalAlignment="Center" Checked="TimeCheckBox_Changed" Unchecked="TimeCheckBox_Changed"/>
                                            <StackPanel Orientation="Horizontal" Margin="20,5,0,5">
                                                <TextBox x:Name="StartTimeH" Width="30" Text="0"/>
                                                <TextBox x:Name="StartTimeM" Width="30" Text="00"/>
                                                <TextBox x:Name="StartTimeS" Width="30" Text="00"/>
                                                <TextBox x:Name="StartTimeMS" Width="40" Text="000"/>
                                            </StackPanel>
                                            <CheckBox x:Name="EnableEndTimeCheckBox" Content="Kết thúc:" VerticalAlignment="Center" Checked="TimeCheckBox_Changed" Unchecked="TimeCheckBox_Changed"/>
                                            <StackPanel Orientation="Horizontal" Margin="20,5,0,5">
                                                <TextBox x:Name="EndTimeH" Width="30" Text="0"/>
                                                <TextBox x:Name="EndTimeM" Width="30" Text="00"/>
                                                <TextBox x:Name="EndTimeS" Width="30" Text="00"/>
                                                <TextBox x:Name="EndTimeMS" Width="40" Text="000"/>
                                            </StackPanel>

                                        </StackPanel>
                                        <StackPanel x:Name="SpeechToTextSettingsPanel" Visibility="{Binding IsChecked, ElementName=ModeSpeechToTextRadio, Converter={StaticResource BooleanToVisibilityConverter}}" Margin="15,0,10,0">
                                            <TextBlock Text="Cài đặt Nhận dạng Giọng nói" Style="{StaticResource SectionHeaderStyle}" />

                                            <!-- Implementation selector - Hidden, WhisperNet is default -->
                                            <StackPanel Orientation="Horizontal" Margin="0,0,0,10" Visibility="Collapsed">
                                                <RadioButton x:Name="WhisperClassicRadio" Content="Classic (Process)" GroupName="WhisperImplGroup" IsChecked="False" Margin="0,0,15,0" Checked="WhisperImpl_Changed"/>
                                                <RadioButton x:Name="WhisperNetRadio" Content="AIOLauncher STT" GroupName="WhisperImplGroup" IsChecked="True" Checked="WhisperImpl_Changed"/>
                                            </StackPanel>

                                            <!-- Classic settings (old implementation) - Hidden -->
                                            <Grid x:Name="WhisperClassicSettings" Visibility="Collapsed">
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition Width="Auto" MinWidth="90"/>
                                                    <ColumnDefinition Width="*"/>
                                                </Grid.ColumnDefinitions>
                                                <Grid.RowDefinitions>
                                                    <RowDefinition Height="Auto"/>
                                                    <RowDefinition Height="Auto"/>
                                                    <RowDefinition Height="Auto"/>
                                                    <RowDefinition Height="Auto"/>
                                                    <RowDefinition Height="Auto"/>
                                                    <RowDefinition Height="Auto"/>
                                                </Grid.RowDefinitions>
                                                <Label Grid.Row="0" Content="Engine:"/>
                                                <ComboBox Grid.Row="0" Grid.Column="1" x:Name="WhisperEngineComboBox" Margin="0,2" SelectionChanged="WhisperEngineComboBox_SelectionChanged"/>
                                                <Label Grid.Row="1" Content="Model:"/>
                                                <ComboBox Grid.Row="1" Grid.Column="1" x:Name="WhisperModelComboBox" Margin="0,2"/>
                                                <Label Grid.Row="2" Content="Ngôn ngữ:"/>
                                                <ComboBox Grid.Row="2" Grid.Column="1" x:Name="WhisperLanguageComboBox" Margin="0,2"/>
                                                <Label Grid.Row="3" Content="Thiết bị:"/>
                                                <ComboBox Grid.Row="3" Grid.Column="1" x:Name="WhisperDeviceComboBox" Margin="0,2"/>
                                                <Label Grid.Row="4" Content="Kiểu tính toán:"/>
                                                <ComboBox Grid.Row="4" Grid.Column="1" x:Name="WhisperComputeTypeComboBox" Margin="0,2"/>
                                                <StackPanel Grid.Row="5" Grid.Column="1" Orientation="Horizontal" Margin="0,8,0,0">
                                                    <Button Content="Tải model..." Width="100" Click="DownloadWhisperModelButton_Click"/>
                                                </StackPanel>
                                            </Grid>

                                            <!-- WhisperNet settings (new implementation) - Now default -->
                                            <Grid x:Name="WhisperNetSettings" Visibility="Visible">
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition Width="Auto" MinWidth="90"/>
                                                    <ColumnDefinition Width="*"/>
                                                </Grid.ColumnDefinitions>
                                                <Grid.RowDefinitions>
                                                    <RowDefinition Height="Auto"/>
                                                    <RowDefinition Height="Auto"/>
                                                    <RowDefinition Height="Auto"/>
                                                    <RowDefinition Height="Auto"/>
                                                </Grid.RowDefinitions>
                                                <Label Grid.Row="0" Content="Model:"/>
                                                <ComboBox Grid.Row="0" Grid.Column="1" x:Name="WhisperNetModelComboBox" Margin="0,2"/>
                                                <Label Grid.Row="1" Content="Ngôn ngữ:"/>
                                                <ComboBox Grid.Row="1" Grid.Column="1" x:Name="WhisperNetLanguageComboBox" Margin="0,2"/>
                                                <Label Grid.Row="2" Content="Runtime:"/>
                                                <TextBlock Grid.Row="2" Grid.Column="1" x:Name="WhisperNetRuntimeTextBlock" Text="Auto-detect (CUDA > Vulkan > CPU)" VerticalAlignment="Center" Foreground="#4CAF50" FontWeight="Bold"/>
                                                <StackPanel Grid.Row="3" Grid.Column="1" Orientation="Horizontal" Margin="0,8,0,0">
                                                    <Button Content="Tải model..." Width="100" Click="DownloadWhisperNetModelButton_Click"/>
                                                </StackPanel>
                                            </Grid>
                                        </StackPanel>
                                    </StackPanel>
                                </ScrollViewer>
                            </Grid>

                            <Grid x:Name="TranslatePanel" Visibility="{Binding IsChecked, ElementName=TranslateTab, Converter={StaticResource BooleanToVisibilityConverter}}">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="Auto" MinWidth="150"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>
                                <Border Grid.Column="0" BorderBrush="{StaticResource CapCut.BorderColor}" BorderThickness="0,0,1,0">
                                    <StackPanel Orientation="Vertical" Margin="5,10">
                                        <RadioButton x:Name="TranslateSrtRadio" Content="Dịch Phụ Đề" GroupName="TranslateModeGroup" Style="{StaticResource LeftNavRadioButtonStyle}" IsChecked="True"/>
                                        <RadioButton x:Name="TranslateApiSettingsRadio" Content="Tuỳ Chỉnh Prompt" GroupName="TranslateModeGroup" Style="{StaticResource LeftNavRadioButtonStyle}"/>
                                        <RadioButton x:Name="TranslateAdvancedRadio" Content="Nâng cao" GroupName="TranslateModeGroup" Style="{StaticResource LeftNavRadioButtonStyle}" IsEnabled="False"/>
                                    </StackPanel>
                                </Border>
                                <Grid Grid.Column="1" Margin="15,10,10,0">
                                    <Grid x:Name="SrtDataGridPanel" Visibility="{Binding IsChecked, ElementName=TranslateSrtRadio, Converter={StaticResource BooleanToVisibilityConverter}}">
                                        <DataGrid x:Name="SrtLinesDataGrid" AutoGenerateColumns="False" CanUserAddRows="False" ItemsSource="{Binding SrtSubtitleLinesView}" PreviewKeyDown="SrtLinesDataGrid_PreviewKeyDown" CellEditEnding="SrtLinesDataGrid_CellEditEnding" >
                                            <DataGrid.Columns>
                                                <DataGridTextColumn Header="STT" Binding="{Binding Index}" Width="SizeToHeader" IsReadOnly="True"/>
                                                <DataGridTextColumn Header="Văn bản gốc" Binding="{Binding OriginalText}" Width="*"/>
                                                <DataGridTextColumn Header="Bản dịch" Binding="{Binding TranslatedText}" Width="*"/>
                                            </DataGrid.Columns>
                                            <DataGrid.RowStyle>
                                                <Style TargetType="DataGridRow" BasedOn="{StaticResource CustomDataGridRowStyle}">
                                                    <EventSetter Event="ContextMenuOpening" Handler="DataGridRow_ContextMenuOpening"/>
                                                </Style>
                                            </DataGrid.RowStyle>
                                        </DataGrid>
                                    </Grid>
                                    <StackPanel x:Name="TranslateApiSettingsPanel" Visibility="{Binding IsChecked, ElementName=TranslateApiSettingsRadio, Converter={StaticResource BooleanToVisibilityConverter}}">
                                        <StackPanel Margin="0,5,0,0">
                                            <CheckBox x:Name="EnableCustomPromptCheckBox" Content="Bật prompt(ngôn ngữ cần dịch, phong cách dịch,...)" Style="{StaticResource ModernCheckBoxStyle}" IsChecked="{Binding IsCustomPromptEnabled, Mode=TwoWay}"/>

                                            <Label Content="Prompt đã lưu"/>
                                            <ComboBox x:Name="CustomPromptComboBox" Margin="0,2,0,10" ItemsSource="{Binding CustomPromptNames}" SelectedItem="{Binding SelectedCustomPromptName}"/>

                                            <Grid Margin="0,10,0,0" Visibility="{Binding IsChecked, ElementName=EnableCustomPromptCheckBox, Converter={StaticResource BooleanToVisibilityConverter}}">
                                                <TextBox x:Name="CustomPromptTextBox" Text="{Binding CurrentCustomPromptText, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" MinHeight="150" TextWrapping="Wrap" AcceptsReturn="True" VerticalScrollBarVisibility="Auto"/>
                                                <Button x:Name="SaveCustomPromptButton" Content="Lưu Prompt"  Style="{StaticResource PrimaryActionButtonStyle}"  HorizontalAlignment="Right" VerticalAlignment="Bottom"  Margin="0,0,10,10" Padding="10,5" Click="SaveCustomPromptButton_Click"/>
                                            </Grid>
                                        </StackPanel>
                                    </StackPanel>
                                    <StackPanel x:Name="TranslateAdvancedPanel" Visibility="{Binding IsChecked, ElementName=TranslateAdvancedRadio, Converter={StaticResource BooleanToVisibilityConverter}}">
                                        <TextBlock Text="Các tùy chọn nâng cao sẽ được thêm vào trong tương lai." Foreground="{StaticResource CapCut.TextSecondaryColor}"/>
                                    </StackPanel>
                                </Grid>
                            </Grid>
                            <Grid x:Name="TtsPanel" Visibility="{Binding IsChecked, ElementName=TtsTab, Converter={StaticResource BooleanToVisibilityConverter}}">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="Auto" MinWidth="150"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>
                                <Border Grid.Column="0" BorderBrush="{StaticResource CapCut.BorderColor}" BorderThickness="0,0,1,0">
                                    <StackPanel Orientation="Vertical" Margin="5,10">
                                        <RadioButton x:Name="TtsModeLongTextRadio" Content="Văn bản dài" GroupName="TtsModeGroup" Style="{StaticResource LeftNavRadioButtonStyle}" IsChecked="True"/>
                                        <RadioButton x:Name="TtsModeVoiceSubRadio" Content="Voice Sub" GroupName="TtsModeGroup" Style="{StaticResource LeftNavRadioButtonStyle}"/>

                                    </StackPanel>

                                </Border>
                                <ScrollViewer Grid.Column="1" VerticalScrollBarVisibility="Auto">
                                    <Grid Margin="15,10,10,0">
                                        <DockPanel x:Name="TtsLongTextPanel" Visibility="{Binding IsChecked, ElementName=TtsModeLongTextRadio, Converter={StaticResource BooleanToVisibilityConverter}}">
                                            <Border DockPanel.Dock="Bottom" Padding="0,10,0,0" Margin="0,10,0,0" BorderBrush="{StaticResource CapCut.BorderColor}" BorderThickness="0,1,0,0">
                                                <Grid>
                                                    <Grid.ColumnDefinitions>
                                                        <ColumnDefinition Width="*"/>
                                                        <ColumnDefinition Width="Auto"/>
                                                    </Grid.ColumnDefinitions>
                                                </Grid>
                                            </Border>
                                            <StackPanel>
                                                <TextBlock Text="Cài đặt AIOLauncher TTS" Style="{StaticResource SectionHeaderStyle}"/>
                                                <Grid>
                                                    <Grid.ColumnDefinitions>
                                                        <ColumnDefinition Width="Auto" MinWidth="90"/>
                                                        <ColumnDefinition Width="*"/>
                                                    </Grid.ColumnDefinitions>
                                                    <Grid.RowDefinitions>
                                                        <RowDefinition Height="Auto"/>
                                                        <RowDefinition Height="Auto"/>
                                                        <RowDefinition Height="Auto"/>
                                                        <RowDefinition Height="Auto"/>
                                                    </Grid.RowDefinitions>

                                                    <Label Grid.Row="0" Content="Model TTS:"/>
                                                    <ComboBox Grid.Row="0" Grid.Column="1" x:Name="AioModelComboBox" Margin="0,2,0,5" DisplayMemberPath="DisplayName" SelectedValuePath="ApiId" SelectionChanged="AioModelComboBox_SelectionChanged"/>

                                                    <Label Grid.Row="1" Content="Ngôn ngữ:"/>
                                                    <ComboBox Grid.Row="1" Grid.Column="1" x:Name="AioLanguageComboBox" Margin="0,2,0,5" DisplayMemberPath="DisplayName" SelectedValuePath="LanguageCode" SelectionChanged="AioLanguageComboBox_SelectionChanged"/>

                                                    <Label Grid.Row="2" Content="Giọng nói:"/>
                                                    <ComboBox Grid.Row="2" Grid.Column="1" x:Name="AioVoiceComboBox" Margin="0,2,0,5" SelectedValuePath="ApiId" DropDownClosed="AioVoiceComboBox_DropDownClosed">
                                                        <ComboBox.ItemTemplate>
                                                            <DataTemplate>
                                                                <Grid Background="Transparent"  MouseEnter="VoiceItem_MouseEnter"  MouseLeave="VoiceItem_MouseLeave">
                                                                    <Grid.ColumnDefinitions>
                                                                        <ColumnDefinition Width="*"/>
                                                                        <ColumnDefinition Width="Auto"/>
                                                                    </Grid.ColumnDefinitions>
                                                                    <TextBlock Grid.Column="0" Text="{Binding DisplayName}" VerticalAlignment="Center"/>
                                                                    <TextBlock x:Name="PlayIcon" Grid.Column="1" Text="" FontFamily="Segoe MDL2 Assets, Segoe UI Symbol, Arial"  VerticalAlignment="Center" Margin="10,0,5,0" Foreground="{StaticResource CapCut.TextSecondaryColor}"  Visibility="Hidden"/>
                                                                </Grid>
                                                                <DataTemplate.Triggers>
                                                                    <Trigger Property="IsMouseOver" Value="True">
                                                                        <Setter TargetName="PlayIcon" Property="Visibility" Value="Visible"/>
                                                                        <Setter TargetName="PlayIcon" Property="Foreground" Value="{StaticResource CapCut.TextColor}"/>
                                                                    </Trigger>
                                                                </DataTemplate.Triggers>
                                                            </DataTemplate>
                                                        </ComboBox.ItemTemplate>
                                                    </ComboBox>

                                                    <Label Grid.Row="3" Content="Tốc độ:"/>
                                                    <Grid Grid.Row="3" Grid.Column="1">
                                                        <Grid.ColumnDefinitions>
                                                            <ColumnDefinition Width="*"/>
                                                            <ColumnDefinition Width="Auto"/>
                                                        </Grid.ColumnDefinitions>
                                                        <Slider Grid.Column="0" x:Name="AioRateSlider"  Minimum="0.25" Maximum="4.0" Value="1.0" TickFrequency="1.0"  TickPlacement="BottomRight" SmallChange="0.01"  LargeChange="0.1" VerticalAlignment="Center"/>
                                                        <TextBlock Grid.Column="1" Text="{Binding Value, ElementName=AioRateSlider, StringFormat={}{0:F2}x}" MinWidth="40" TextAlignment="Right" VerticalAlignment="Center"/>
                                                    </Grid>
                                                </Grid>

                                                <TextBlock Text="Nhập văn bản cần chuyển đổi" Style="{StaticResource SectionHeaderStyle}" Margin="0,15,0,5"/>
                                                <TextBox x:Name="TtsInputTextBox" TextWrapping="Wrap" AcceptsReturn="True" VerticalScrollBarVisibility="Auto" MinHeight="200" TextChanged="TtsInputTextBox_TextChanged"/>
                                            </StackPanel>
                                        </DockPanel>
                                        <StackPanel x:Name="TtsVoiceSubPanel" Visibility="{Binding IsChecked, ElementName=TtsModeVoiceSubRadio, Converter={StaticResource BooleanToVisibilityConverter}}">
                                            <TextBlock Text="Tạo giọng nói cho phụ đề" Style="{StaticResource SectionHeaderStyle}"/>
                                            <TextBlock TextWrapping="Wrap" Foreground="{StaticResource CapCut.TextSecondaryColor}" Margin="0,0,0,15">
                                                Tính năng này sẽ sử dụng dữ liệu từ tab "Dịch". Vui lòng chọn các dòng cần tạo giọng nói trong bảng dữ liệu bên đó, sau đó quay lại đây và nhấn nút bên dưới.
                                            </TextBlock>
                                        </StackPanel>
                                    </Grid>
                                </ScrollViewer>
                            </Grid>
                        </Grid>

                    </DockPanel>
                </Grid>

                <GridSplitter Grid.Column="1" Width="8" HorizontalAlignment="Stretch"/>
                <DockPanel Grid.Column="2" Margin="0,8,0,8">
                    <TextBlock DockPanel.Dock="Top" Text="Trình phát" Margin="0,0,0,5" Foreground="{StaticResource CapCut.TextSecondaryColor}"/>

                    <Border Background="{StaticResource CapCut.PanelBackground}" CornerRadius="8" x:Name="VideoContainerBorder" SizeChanged="VideoContainerBorder_SizeChanged" PreviewMouseWheel="VideoContainer_PreviewMouseWheel">
                        <Grid>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="*"/>
                                <RowDefinition Height="Auto"/>
                            </Grid.RowDefinitions>

                            <Grid x:Name="PlayerClipArea" Grid.Row="0" ClipToBounds="True">

                                <Grid Grid.Row="0" ClipToBounds="True">
                                    
                                    <Viewbox Stretch="Uniform">
                                        <Grid x:Name="videoGrid"  Background="Black" RenderTransformOrigin="0.5,0.5">
                                            <Grid.RenderTransform>
                                                <TransformGroup>
                                                    <ScaleTransform x:Name="videoGridScaleTransform" ScaleX="1" ScaleY="1"/>
                                                    <TranslateTransform x:Name="videoGridTranslateTransform" X="0" Y="0"/>
                                                </TransformGroup>
                                            </Grid.RenderTransform>
                                            <Grid.Clip>
                                                <RectangleGeometry>
                                                    <RectangleGeometry.Rect>
                                                        <MultiBinding Converter="{StaticResource SizeToRectConverter}">
                                                            <Binding ElementName="videoGrid" Path="ActualWidth"/>
                                                            <Binding ElementName="videoGrid" Path="ActualHeight"/>
                                                        </MultiBinding>
                                                    </RectangleGeometry.Rect>
                                                </RectangleGeometry>
                                            </Grid.Clip>
                                                <Grid x:Name="MediaPlayerContainer">
                                                    <!-- PlayerHostGrid - FFME MediaElement playback system -->
                                                    <Grid x:Name="PlayerHostGrid">

                                                        <!-- FFME MediaElement - Thay thế custom FFmpeg decoder -->
                                                        <ffme:MediaElement x:Name="FFMEMediaPlayer"
                                                                          Background="Black"
                                                                          LoadedBehavior="Pause"
                                                                          UnloadedBehavior="Manual"
                                                                          Stretch="Uniform"
                                                                          RenderTransformOrigin="0.5,0.5"
                                                                          Panel.ZIndex="5"
                                                                          ScrubbingEnabled="True">
                                                            <ffme:MediaElement.RenderTransform>
                                                                <TransformGroup>
                                                                    <ScaleTransform x:Name="FFMEVideoScaleTransform" ScaleX="1" ScaleY="1" />
                                                                    <TranslateTransform x:Name="FFMEVideoTranslateTransform" X="0" Y="0" />
                                                                    <RotateTransform x:Name="FFMEVideoRotateTransform" Angle="0" />
                                                                </TransformGroup>
                                                            </ffme:MediaElement.RenderTransform>
                                                        </ffme:MediaElement>

                                                        <!-- Legacy Image control - giữ lại cho backward compatibility nếu cần -->
                                                        <Image x:Name="NewPlaybackImage"
                                                               Stretch="Uniform"
                                                               RenderTransformOrigin="0.5,0.5"
                                                               Panel.ZIndex="4"
                                                               Visibility="Collapsed"
                                                               RenderOptions.BitmapScalingMode="HighQuality">
                                                            <Image.RenderTransform>
                                                                <TransformGroup>
                                                                    <ScaleTransform x:Name="NewVideoScaleTransform" ScaleX="1" ScaleY="1" />
                                                                    <TranslateTransform x:Name="NewVideoTranslateTransform" X="0" Y="0" />
                                                                    <RotateTransform x:Name="NewVideoRotateTransform" Angle="0" />
                                                                </TransformGroup>
                                                            </Image.RenderTransform>
                                                        </Image>

                                                        <!-- Trình phát ảnh tĩnh (giữ nguyên) -->
                                                        <Image x:Name="StaticImagePlayer" Stretch="Uniform" Visibility="Collapsed" RenderTransformOrigin="0.5,0.5" Panel.ZIndex="6">
                                                            <Image.RenderTransform>
                                                                <TransformGroup>
                                                                    <ScaleTransform x:Name="ImageScaleTransform" ScaleX="1" ScaleY="1" />
                                                                    <TranslateTransform x:Name="ImageTranslateTransform" X="0" Y="0" />
                                                                </TransformGroup>
                                                            </Image.RenderTransform>
                                                        </Image>

                                                    </Grid>
                                                </Grid>
                                                <Canvas x:Name="SubtitleRenderCanvas">
                                                <Canvas.Clip>
                                                    <RectangleGeometry>
                                                        <RectangleGeometry.Rect>
                                                            <MultiBinding Converter="{StaticResource SizeToRectConverter}">
                                                                <Binding ElementName="videoGrid" Path="ActualWidth"/>
                                                                <Binding ElementName="videoGrid" Path="ActualHeight"/>
                                                            </MultiBinding>
                                                        </RectangleGeometry.Rect>
                                                    </RectangleGeometry>
                                                </Canvas.Clip>
                                            </Canvas>

                                            <Border x:Name="AngleDisplay" Visibility="Collapsed" HorizontalAlignment="Center" VerticalAlignment="Top" Margin="0,20,0,0" Padding="12,6" Background="#CC1A1A1A" CornerRadius="15" BorderBrush="#80FFFFFF" BorderThickness="1">
                                                <TextBlock x:Name="AngleDisplayText" Text="0.00°" Foreground="White" FontSize="60" FontWeight="SemiBold" />
                                            </Border>
                                            <AdornerDecorator x:Name="PlayerAdornerDecorator">
                                                <AdornerDecorator.Clip>
                                                    <RectangleGeometry>
                                                        <RectangleGeometry.Rect>
                                                            <MultiBinding Converter="{StaticResource SizeToRectConverter}">
                                                                <Binding ElementName="PlayerAdornerDecorator" Path="ActualWidth"/>
                                                                <Binding ElementName="PlayerAdornerDecorator" Path="ActualHeight"/>
                                                            </MultiBinding>
                                                        </RectangleGeometry.Rect>
                                                    </RectangleGeometry>
                                                </AdornerDecorator.Clip>
                                            </AdornerDecorator>
                                        </Grid>
                                    </Viewbox>

                                    <Canvas x:Name="overlayCanvas" Background="Transparent" Style="{StaticResource CropThumbCanvasStyle}">
                                        <Thumb x:Name="topThumb" Height="2" Background="#CCFFFFFF" Cursor="SizeNS" DragDelta="Thumb_DragDelta" />
                                        <Thumb x:Name="bottomThumb" Height="2" Background="#CCFFFFFF" Cursor="SizeNS" DragDelta="Thumb_DragDelta" />
                                        <Thumb x:Name="leftThumb" Width="2" Background="#CCFFFFFF" Cursor="SizeWE" DragDelta="Thumb_DragDelta" />
                                        <Thumb x:Name="rightThumb" Width="2" Background="#CCFFFFFF" Cursor="SizeWE" DragDelta="Thumb_DragDelta" />
                                    </Canvas>
                                </Grid>
                            </Grid>
                            <Grid Grid.Row="1" Margin="10">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>
                                <StackPanel Grid.Column="0" Orientation="Horizontal" VerticalAlignment="Center">
                                    <TextBlock x:Name="currentTimeTextBlock" Text="00:00:00.000" Foreground="{StaticResource CapCut.AccentColor}" FontWeight="SemiBold" FontFamily="Consolas"/>
                                    <TextBlock Text=" / " Margin="5,0" Foreground="{StaticResource CapCut.TextSecondaryColor}" FontFamily="Consolas"/>
                                    <TextBlock x:Name="totalDurationTextBlock" Text="00:00:00.000" Foreground="{StaticResource CapCut.TextSecondaryColor}" FontFamily="Consolas"/>
                                </StackPanel>
                                <StackPanel Grid.Column="1" Orientation="Horizontal" HorizontalAlignment="Center" VerticalAlignment="Center">
                                    <Button x:Name="playPauseButton" Content="" FontFamily="Segoe MDL2 Assets, Segoe UI Symbol, Arial" FontSize="20" FontWeight="Bold" Style="{StaticResource PlayerControlButtonStyle}" Click="PlayPauseButton_Click"/>
                                </StackPanel>
                                <StackPanel Grid.Column="2" Orientation="Horizontal">
                                    <Button Content="" FontFamily="Segoe MDL2 Assets, Segoe UI Symbol, Arial" Style="{StaticResource PlayerControlButtonStyle}" IsEnabled="False"/>
                                </StackPanel>
                            </Grid>

                        </Grid>
                    </Border>
                </DockPanel>

                <GridSplitter Grid.Column="3" Width="8" HorizontalAlignment="Stretch"/>

                <Grid Grid.Column="4" Margin="0,8,8,8" Background="{StaticResource CapCut.PanelBackground}">
                    <ScrollViewer x:Name="EditorPanel" VerticalScrollBarVisibility="Auto" Visibility="Collapsed">
                        <StackPanel Margin="15,10">
                            <Label Content="Văn bản ( chỉnh sửa tại đây)"/>
                            <TextBox x:Name="SelectedTextEditorTextBox" TextWrapping="Wrap"  AcceptsReturn="True" InputMethod.IsInputMethodEnabled="True"
         InputMethod.PreferredImeState="On"  MinHeight="60" VerticalScrollBarVisibility="Auto" Margin="0,0,0,15" TextChanged="SelectedTextEditorTextBox_TextChanged"/>

                            <TextBlock Text="Kiểu mặc định" Foreground="{StaticResource CapCut.TextSecondaryColor}" Margin="0,0,0,5"/>
                            <ItemsControl x:Name="PresetItemsControl" ItemTemplate="{StaticResource StylePresetTemplate}">
                                <ItemsControl.ItemsPanel>
                                    <ItemsPanelTemplate>
                                        <WrapPanel/>
                                    </ItemsPanelTemplate>
                                </ItemsControl.ItemsPanel>
                            </ItemsControl>

                            <StackPanel>
                                <Label Content="Phông chữ"/>
                                <ComboBox x:Name="FontFamilyComboBox" Margin="0,0,0,5" VerticalContentAlignment="Center" DropDownOpened="FontFamilyComboBox_DropDownOpened" DropDownClosed="FontFamilyComboBox_DropDownClosed">
                                    <ComboBox.ItemTemplate>
                                        <DataTemplate>
                                            <TextBlock Text="{Binding Source}"  FontFamily="{Binding}" FontSize="14" MouseEnter="FontFamilyTextBlock_MouseEnter"/>
                                        </DataTemplate>
                                    </ComboBox.ItemTemplate>
                                </ComboBox>
                                <Label Content="Cỡ chữ"/>
                                <Grid Margin="0,0,0,5">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="Auto"/>
                                    </Grid.ColumnDefinitions>
                                    <Slider Grid.Column="0" x:Name="FontSizeSlider" Minimum="10" Maximum="200" Value="40" VerticalAlignment="Center"/>
                                    <TextBox Grid.Column="1" x:Name="FontSizeTextBox" Width="40" Text="{Binding Value, ElementName=FontSizeSlider, StringFormat=F0}" VerticalAlignment="Center"/>
                                </Grid>
                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="Auto"/>
                                        <ColumnDefinition Width="*"/>
                                    </Grid.ColumnDefinitions>
                                    <StackPanel Grid.Column="0" Margin="0,0,15,0">
                                        <Label Content="Hoa văn"/>
                                        <StackPanel Orientation="Horizontal" Margin="0,5,0,0">
                                            <ToggleButton x:Name="BoldButton" Style="{StaticResource EditorPanelToggleButtonStyle}" FontWeight="Bold" Content="B"/>
                                            <ToggleButton x:Name="ItalicButton" Style="{StaticResource EditorPanelToggleButtonStyle}" FontStyle="Italic" Margin="5,0" Content="I"/>
                                            <ToggleButton x:Name="UnderlineButton" Style="{StaticResource EditorPanelToggleButtonStyle}">
                                                <TextBlock Text="U" TextDecorations="Underline"/>
                                            </ToggleButton>
                                        </StackPanel>
                                    </StackPanel>
                                    <StackPanel Grid.Column="1">
                                        <Label Content="Căn chỉnh"/>
                                        <StackPanel Orientation="Horizontal" Margin="0,5,0,0">
                                            <ToggleButton x:Name="AlignLeftButton" Style="{StaticResource EditorPanelToggleButtonStyle}" ToolTip="Căn trái" Click="AlignmentButton_Click">
                                                <TextBlock Text="&#xE8E4;" FontFamily="Segoe MDL2 Assets, Segoe UI Symbol, Arial" FontSize="16" VerticalAlignment="Center"/>
                                            </ToggleButton>
                                            <ToggleButton x:Name="AlignCenterButton" Style="{StaticResource EditorPanelToggleButtonStyle}" Margin="5,0" ToolTip="Căn giữa" Click="AlignmentButton_Click">
                                                <TextBlock Text="&#xE8E3;" FontFamily="Segoe MDL2 Assets, Segoe UI Symbol, Arial" FontSize="16" VerticalAlignment="Center"/>
                                            </ToggleButton>
                                            <ToggleButton x:Name="AlignRightButton" Style="{StaticResource EditorPanelToggleButtonStyle}" ToolTip="Căn phải" Click="AlignmentButton_Click">
                                                <TextBlock Text="&#xE8E2;" FontFamily="Segoe MDL2 Assets, Segoe UI Symbol, Arial" FontSize="16" VerticalAlignment="Center"/>
                                            </ToggleButton>
                                            <ToggleButton x:Name="AlignJustifyButton" Style="{StaticResource EditorPanelToggleButtonStyle}" Margin="5,0" ToolTip="Căn đều hai bên (Justify)" Click="AlignmentButton_Click">
                                                <TextBlock Text="&#xE8E5;" FontFamily="Segoe MDL2 Assets, Segoe UI Symbol, Arial" FontSize="16" VerticalAlignment="Center"/>
                                            </ToggleButton>
                                        </StackPanel>
                                    </StackPanel>
                                </Grid>

                                <Label Content="Màu sắc"/>
                                <xctk:ColorPicker x:Name="FontColorPicker" SelectedColor="White" Loaded="ColorPicker_Loaded" Style="{StaticResource ModernColorPickerStyle}"/>
                                <Label Content="Độ mờ"/>
                                <Grid Margin="0,0,0,5">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="Auto"/>
                                    </Grid.ColumnDefinitions>
                                    <Slider Grid.Column="0" x:Name="OpacitySlider" Minimum="0" Maximum="100" Value="100" VerticalAlignment="Center"/>
                                    <TextBox Grid.Column="1" x:Name="OpacityTextBox" Width="40" Text="{Binding Value, ElementName=OpacitySlider, StringFormat=F0}" VerticalAlignment="Center"/>
                                </Grid>
                                <Label Content="Ký tự"/>
                                <Grid Margin="0,5">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="Auto"/>
                                        <ColumnDefinition Width="*"/>
                                    </Grid.ColumnDefinitions>
                                    <TextBlock Text="Giãn cách" VerticalAlignment="Center" Margin="0,0,10,0"/>
                                    <Slider Grid.Column="1" x:Name="CharacterSpacingSlider" Minimum="-10" Maximum="50" Value="0"/>
                                </Grid>
                            </StackPanel>

                            <Expander Header="Phông nền" Margin="0,10,0,0" Style="{StaticResource AccordionExpanderStyle}">
                                <StackPanel>
                                    <CheckBox x:Name="BackgroundEnabledCheckBox" Content="Bật phông nền" Margin="0,5" Style="{StaticResource ModernCheckBoxStyle}"/>
                                    <StackPanel x:Name="BackgroundSettingsPanel" Visibility="Collapsed">
                                        <Label Content="Màu nền"/>
                                        <xctk:ColorPicker x:Name="BackgroundColorPicker" SelectedColor="Black" Loaded="ColorPicker_Loaded" Style="{StaticResource ModernColorPickerStyle}"/>

                                        <Label Content="Độ mờ"/>
                                        <Slider x:Name="BackgroundOpacitySlider" Minimum="0" Maximum="100" Value="50"/>
                                        <Label Content="Bo góc"/>
                                        <Slider x:Name="BackgroundCornerRadiusSlider" Minimum="0" Maximum="50" Value="10"/>
                                        <Label Content="Đệm ngang (chiều rộng)"/>
                                        <Slider x:Name="BackgroundPaddingXSlider" Minimum="0" Maximum="100" Value="30"/>

                                        <Label Content="Đệm dọc (chiều cao)"/>
                                        <Slider x:Name="BackgroundPaddingYSlider" Minimum="0" Maximum="50" Value="10"/>
                                    </StackPanel>
                                </StackPanel>
                            </Expander>

                            <Expander Header="Tô viền" Margin="0,10,0,0" Style="{StaticResource AccordionExpanderStyle}">
                                <StackPanel>
                                    <CheckBox x:Name="OutlineEnabledCheckBox" Content="Bật tô viền" Margin="0,5,0,0" Style="{StaticResource ModernCheckBoxStyle}"/>
                                    <StackPanel x:Name="OutlineSettingsPanel" Visibility="Collapsed">
                                        <Label Content="Màu viền"/>
                                        <xctk:ColorPicker x:Name="OutlineColorPicker" SelectedColor="Black" Style="{StaticResource ModernColorPickerStyle}"/>
                                        <Label Content="Độ dày"/>
                                        <Slider x:Name="OutlineThicknessSlider" Minimum="0" Maximum="20" Value="2"/>
                                    </StackPanel>
                                </StackPanel>
                            </Expander>

                            <Expander Header="Bóng" Margin="0,10,0,0" Style="{StaticResource AccordionExpanderStyle}">
                                <StackPanel>
                                    <CheckBox x:Name="ShadowEnabledCheckBox" Content="Bật bóng" Margin="0,5,0,0" Style="{StaticResource ModernCheckBoxStyle}"/>
                                    <StackPanel x:Name="ShadowSettingsPanel" Visibility="Collapsed">
                                        <Label Content="Màu bóng"/>
                                        <xctk:ColorPicker x:Name="ShadowColorPicker" SelectedColor="Black" Loaded="ColorPicker_Loaded" Style="{StaticResource ModernColorPickerStyle}"/>
                                        <Label Content="Độ mờ"/>
                                        <Slider x:Name="ShadowOpacitySlider" Minimum="0" Maximum="100" Value="70"/>
                                        <Label Content="Độ nhòe"/>
                                        <Slider x:Name="ShadowBlurSlider" Minimum="0" Maximum="30" Value="5"/>
                                        <Label Content="Khoảng cách"/>
                                        <Slider x:Name="ShadowDepthSlider" Minimum="0" Maximum="30" Value="5"/>
                                        <Label Content="Hướng"/>
                                        <Slider x:Name="ShadowDirectionSlider" Minimum="0" Maximum="360" Value="315"/>
                                    </StackPanel>
                                </StackPanel>
                            </Expander>

                            <Expander Header="Rực sáng" Margin="0,10,0,0" Style="{StaticResource AccordionExpanderStyle}" IsEnabled="False"/>
                            <Expander Header="Uốn cong" Margin="0,10,0,0" Style="{StaticResource AccordionExpanderStyle}" IsEnabled="False"/>

                        </StackPanel>
                    </ScrollViewer>
                    <Grid x:Name="AudioEditorPanel" DataContext="{Binding SelectedAudioClip}"
                      Visibility="{Binding SelectedAudioClip, RelativeSource={RelativeSource AncestorType=local:MainWindow}, Converter={StaticResource NullToVisibilityConverter}, ConverterParameter=VisibleIfNotNull}">
                        <TabControl Background="Transparent" BorderThickness="0">
                            <!-- Tab 1: Cơ bản (Basic) -->
                            <TabItem Header="Cơ bản">
                                <ScrollViewer VerticalScrollBarVisibility="Auto">
                                    <StackPanel Margin="15,10">
                                        <Expander Header="Âm lượng" Style="{StaticResource AccordionExpanderStyle}" IsExpanded="True">
                                            <StackPanel>
                                                <Grid>
                                                    <Grid.ColumnDefinitions>
                                                        <ColumnDefinition Width="*"/>
                                                        <ColumnDefinition Width="Auto"/>
                                                    </Grid.ColumnDefinitions>
                                                    <Slider Grid.Column="0" x:Name="AudioVolumeSlider" Minimum="-60" Maximum="20" Value="{Binding VolumeDb, Mode=TwoWay}" VerticalAlignment="Center"/>
                                                    <TextBox Grid.Column="1" Width="60" Text="{Binding Value, ElementName=AudioVolumeSlider, StringFormat={}{0:F1}dB}" VerticalAlignment="Center"/>
                                                </Grid>
                                                <Label Content="Rõ dần" Margin="0,10,0,0"/>
                                                <Grid>
                                                    <Grid.ColumnDefinitions>
                                                        <ColumnDefinition Width="*"/>
                                                        <ColumnDefinition Width="Auto"/>
                                                    </Grid.ColumnDefinitions>
                                                    <Slider Grid.Column="0" x:Name="AudioFadeInSlider" Minimum="0" Maximum="5" Value="{Binding FadeInDuration, Mode=TwoWay}" VerticalAlignment="Center"/>
                                                    <TextBox Grid.Column="1" Width="60" Text="{Binding Value, ElementName=AudioFadeInSlider, StringFormat={}{0:F1}s}" VerticalAlignment="Center"/>
                                                </Grid>
                                                <Label Content="Mờ dần" Margin="0,10,0,0"/>
                                                <Grid>
                                                    <Grid.ColumnDefinitions>
                                                        <ColumnDefinition Width="*"/>
                                                        <ColumnDefinition Width="Auto"/>
                                                    </Grid.ColumnDefinitions>
                                                    <Slider Grid.Column="0" x:Name="AudioFadeOutSlider" Minimum="0" Maximum="5" Value="{Binding FadeOutDuration, Mode=TwoWay}" VerticalAlignment="Center"/>
                                                    <TextBox Grid.Column="1" Width="60" Text="{Binding Value, ElementName=AudioFadeOutSlider, StringFormat={}{0:F1}s}" VerticalAlignment="Center"/>
                                                </Grid>
                                            </StackPanel>
                                        </Expander>

                                        <Expander Header="Tốc độ" Margin="0,10,0,0" Style="{StaticResource AccordionExpanderStyle}" IsExpanded="True">
                                            <StackPanel>
                                                <Label Content="Tốc độ"/>
                                                <ComboBox x:Name="AudioSpeedComboBox"
                                                      SelectedItem="{Binding Speed, Mode=TwoWay}"
                                                      SelectionChanged="AudioSpeedComboBox_SelectionChanged"/>
                                                <Label Content="Thời lượng" Margin="0,10,0,0"/>
                                                <TextBlock Text="{Binding EffectiveDuration, StringFormat=Duration: {0:hh\\:mm\\:ss\\.fff}}" Foreground="{StaticResource CapCut.TextSecondaryColor}"/>
                                                <CheckBox Content="Thay đổi cao độ âm thanh" IsChecked="{Binding PitchCorrection, Mode=TwoWay}" Margin="0,15,0,0"/>
                                            </StackPanel>
                                        </Expander>
                                    </StackPanel>
                                </ScrollViewer>
                            </TabItem>

                            <!-- Tab 2: Âm thanh nâng cao (Advanced Audio) -->
                            <TabItem Header="Âm thanh nâng cao">
                                <ScrollViewer VerticalScrollBarVisibility="Auto">
                                    <StackPanel Margin="15,10">
                                        <!-- Voice Presets -->
                                        <Expander Header="Preset Giọng" Style="{StaticResource AccordionExpanderStyle}" IsExpanded="True">
                                            <WrapPanel>
                                                <!-- Basic Presets -->
                                                <Button Content="👶 Trẻ em" Tag="Child" Click="AudioPresetButton_Click" Margin="5" Padding="10,5"/>
                                                <Button Content="👩 Nữ cao" Tag="HighFemale" Click="AudioPresetButton_Click" Margin="5" Padding="10,5"/>
                                                <Button Content="🧔 Nam trầm" Tag="DeepMale" Click="AudioPresetButton_Click" Margin="5" Padding="10,5"/>
                                                <Button Content="👹 Quái vật" Tag="Monster" Click="AudioPresetButton_Click" Margin="5" Padding="10,5"/>
                                                <Button Content="👻 Ma quái" Tag="Ghost" Click="AudioPresetButton_Click" Margin="5" Padding="10,5"/>
                                                <Button Content="🎪 Hoạt hình" Tag="Cartoon" Click="AudioPresetButton_Click" Margin="5" Padding="10,5"/>
                                                <!-- Advanced Presets -->
                                                <Button Content="🎈 Helium" Tag="Helium" Click="AudioPresetButton_Click" Margin="5" Padding="10,5"/>
                                                <Button Content="🤖 Robot" Tag="Robot" Click="AudioPresetButton_Click" Margin="5" Padding="10,5"/>
                                                <Button Content="🗿 Khổng lồ" Tag="Deep" Click="AudioPresetButton_Click" Margin="5" Padding="10,5"/>
                                                <Button Content="🔋 Pin yếu" Tag="LowBattery" Click="AudioPresetButton_Click" Margin="5" Padding="10,5"/>
                                                <Button Content="😨 Run rẩy" Tag="Tremble" Click="AudioPresetButton_Click" Margin="5" Padding="10,5"/>
                                                <!-- Environment Effects -->
                                                <Button Content="🎤 Mic Echo" Tag="MicEcho" Click="AudioPresetButton_Click" Margin="5" Padding="10,5"/>
                                                <Button Content="🕳️ Hang động" Tag="Cave" Click="AudioPresetButton_Click" Margin="5" Padding="10,5"/>
                                                <Button Content="📻 Radio cũ" Tag="Radio" Click="AudioPresetButton_Click" Margin="5" Padding="10,5"/>
                                                <Button Content="☎️ Điện thoại" Tag="Telephone" Click="AudioPresetButton_Click" Margin="5" Padding="10,5"/>
                                                <Button Content="📢 Loa phường" Tag="Megaphone" Click="AudioPresetButton_Click" Margin="5" Padding="10,5"/>
                                                <!-- EQ -->
                                                <Button Content="🔊 Bass Boost" Tag="BassBoost" Click="AudioPresetButton_Click" Margin="5" Padding="10,5"/>
                                                <Button Content="🔇 No Bass" Tag="NoBass" Click="AudioPresetButton_Click" Margin="5" Padding="10,5"/>
                                                <!-- Reset -->
                                                <Button Content="🔄 Mặc định" Tag="Reset" Background="#33FFFFFF" Click="AudioPresetButton_Click" Margin="5" Padding="10,5"/>
                                            </WrapPanel>
                                        </Expander>

                                        <!-- Manual Controls -->
                                        <Expander Header="Điều chỉnh chi tiết" Margin="0,10,0,0" Style="{StaticResource AccordionExpanderStyle}" IsExpanded="True">
                                            <StackPanel>
                                                <!-- Pitch Control -->
                                                <Label Content="Cao độ (Pitch)" Margin="0,5,0,0"/>
                                                <Grid>
                                                    <Grid.ColumnDefinitions>
                                                        <ColumnDefinition Width="*"/>
                                                        <ColumnDefinition Width="Auto"/>
                                                    </Grid.ColumnDefinitions>
                                                    <Slider Grid.Column="0" x:Name="AudioPitchSlider" Minimum="-12" Maximum="12" Value="{Binding PitchSemitones, Mode=TwoWay}" VerticalAlignment="Center" ValueChanged="AudioEffectSlider_ValueChanged"/>
                                                    <TextBox Grid.Column="1" Width="80" Text="{Binding Value, ElementName=AudioPitchSlider, StringFormat={}{0:F0} semitones}" VerticalAlignment="Center"/>
                                                </Grid>

                                                <!-- Formant Control -->
                                                <Label Content="Formant (Đặc tính giọng)" Margin="0,10,0,0"/>
                                                <Grid>
                                                    <Grid.ColumnDefinitions>
                                                        <ColumnDefinition Width="*"/>
                                                        <ColumnDefinition Width="Auto"/>
                                                    </Grid.ColumnDefinitions>
                                                    <Slider Grid.Column="0" x:Name="AudioFormantSlider" Minimum="-0.5" Maximum="0.5" Value="{Binding FormantShift, Mode=TwoWay}" VerticalAlignment="Center" ValueChanged="AudioEffectSlider_ValueChanged"/>
                                                    <TextBox Grid.Column="1" Width="60" Text="{Binding Value, ElementName=AudioFormantSlider, StringFormat={}{0:P0}}" VerticalAlignment="Center"/>
                                                </Grid>

                                                <!-- Reverb Control -->
                                                <Label Content="Tiếng vang (Reverb)" Margin="0,10,0,0"/>
                                                <Grid>
                                                    <Grid.ColumnDefinitions>
                                                        <ColumnDefinition Width="*"/>
                                                        <ColumnDefinition Width="Auto"/>
                                                    </Grid.ColumnDefinitions>
                                                    <Slider Grid.Column="0" x:Name="AudioReverbSlider" Minimum="0" Maximum="1" Value="{Binding ReverbMix, Mode=TwoWay}" VerticalAlignment="Center" ValueChanged="AudioEffectSlider_ValueChanged"/>
                                                    <TextBox Grid.Column="1" Width="60" Text="{Binding Value, ElementName=AudioReverbSlider, StringFormat={}{0:P0}}" VerticalAlignment="Center"/>
                                                </Grid>

                                                <!-- Echo Control -->
                                                <Label Content="Tiếng dội (Echo)" Margin="0,10,0,0"/>
                                                <Grid>
                                                    <Grid.ColumnDefinitions>
                                                        <ColumnDefinition Width="*"/>
                                                        <ColumnDefinition Width="Auto"/>
                                                    </Grid.ColumnDefinitions>
                                                    <Slider Grid.Column="0" x:Name="AudioEchoSlider" Minimum="0" Maximum="500" Value="{Binding EchoDelayMs, Mode=TwoWay}" VerticalAlignment="Center" ValueChanged="AudioEffectSlider_ValueChanged"/>
                                                    <TextBox Grid.Column="1" Width="60" Text="{Binding Value, ElementName=AudioEchoSlider, StringFormat={}{0:F0}ms}" VerticalAlignment="Center"/>
                                                </Grid>

                                                <!-- Distortion Control -->
                                                <Label Content="Méo tiếng (Distortion)" Margin="0,10,0,0"/>
                                                <Grid>
                                                    <Grid.ColumnDefinitions>
                                                        <ColumnDefinition Width="*"/>
                                                        <ColumnDefinition Width="Auto"/>
                                                    </Grid.ColumnDefinitions>
                                                    <Slider Grid.Column="0" x:Name="AudioDistortionSlider" Minimum="0" Maximum="1" Value="{Binding DistortionAmount, Mode=TwoWay}" VerticalAlignment="Center" ValueChanged="AudioEffectSlider_ValueChanged"/>
                                                    <TextBox Grid.Column="1" Width="60" Text="{Binding Value, ElementName=AudioDistortionSlider, StringFormat={}{0:P0}}" VerticalAlignment="Center"/>
                                                </Grid>
                                            </StackPanel>
                                        </Expander>
                                    </StackPanel>
                                </ScrollViewer>
                            </TabItem>
                        </TabControl>
                    </Grid>
                    <ScrollViewer x:Name="VideoEditorPanel" VerticalScrollBarVisibility="Auto" DataContext="{Binding SelectedTimelineClip}" Visibility="{Binding SelectedTimelineClip, RelativeSource={RelativeSource AncestorType=local:MainWindow}, Converter={StaticResource NullToVisibilityConverter}, ConverterParameter=VisibleIfNotNull}">
                        <StackPanel Margin="15,10">
                            <Expander Header="Âm lượng" Style="{StaticResource AccordionExpanderStyle}" IsExpanded="True">
                                <StackPanel>
                                    <Grid>
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="*"/>
                                            <ColumnDefinition Width="Auto"/>
                                        </Grid.ColumnDefinitions>
                                        <Slider Grid.Column="0" x:Name="VideoVolumeSlider" Minimum="-50" Maximum="20" Value="{Binding VolumeDb, Mode=TwoWay}" VerticalAlignment="Center"/>
                                        <TextBox Grid.Column="1" Width="60" Text="{Binding Value, ElementName=VideoVolumeSlider, StringFormat={}{0:F1}dB}" VerticalAlignment="Center"/>
                                    </Grid>
                                </StackPanel>
                            </Expander>
                            <Expander Header="Biến đổi" Style="{StaticResource AccordionExpanderStyle}" IsExpanded="True">
                                <StackPanel>
                                    <StackPanel x:Name="UniformScalePanel">
                                        <StackPanel.Style>
                                            <Style TargetType="StackPanel">
                                                <Setter Property="Visibility" Value="Visible"/>
                                                <Style.Triggers>
                                                    <DataTrigger Binding="{Binding SourceData.IsUniformScale}" Value="False">
                                                        <Setter Property="Visibility" Value="Collapsed"/>
                                                    </DataTrigger>
                                                </Style.Triggers>
                                            </Style>
                                        </StackPanel.Style>
                                        <Label Content="Tỷ lệ"/>
                                        <Grid>
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="*"/>
                                                <ColumnDefinition Width="Auto"/>
                                            </Grid.ColumnDefinitions>
                                            <Slider Grid.Column="0" x:Name="VideoScaleSlider" Minimum="50" Maximum="200"   Value="{Binding SourceData.Scale, Converter={StaticResource PercentageConverter}, Mode=TwoWay}"  VerticalAlignment="Center" PreviewMouseLeftButtonDown="TransformControl_InteractionStarted" PreviewMouseLeftButtonUp="TransformControl_InteractionCompleted"/>
                                            <TextBox Grid.Column="1" Width="60"  Text="{Binding Value, ElementName=VideoScaleSlider, StringFormat={}{0:F0}%}"  VerticalAlignment="Center"  GotFocus="TransformControl_InteractionStarted" LostFocus="TextBox_LostFocus_TriggerSmartLogic"/>
                                        </Grid>
                                    </StackPanel>
                                    <StackPanel x:Name="NonUniformScalePanel">
                                        <StackPanel.Style>
                                            <Style TargetType="StackPanel">
                                                <Setter Property="Visibility" Value="Collapsed"/>
                                                <Style.Triggers>
                                                    <DataTrigger Binding="{Binding SourceData.IsUniformScale}" Value="False">
                                                        <Setter Property="Visibility" Value="Visible"/>
                                                    </DataTrigger>
                                                </Style.Triggers>
                                            </Style>
                                        </StackPanel.Style>
                                        <Label Content="Thu phóng chiều ngang"/>
                                        <Grid>
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="*"/>
                                                <ColumnDefinition Width="Auto"/>
                                            </Grid.ColumnDefinitions>
                                            <Slider Grid.Column="0" x:Name="VideoScaleXSlider" Minimum="50" Maximum="200"  Value="{Binding SourceData.ScaleX, Converter={StaticResource PercentageConverter}, Mode=TwoWay}"  VerticalAlignment="Center" PreviewMouseLeftButtonDown="TransformControl_InteractionStarted" PreviewMouseLeftButtonUp="TransformControl_InteractionCompleted"/>
                                            <TextBox Grid.Column="1" Width="60"  Text="{Binding Value, ElementName=VideoScaleXSlider, StringFormat={}{0:F0}%}"  VerticalAlignment="Center"  GotFocus="TransformControl_InteractionStarted" LostFocus="TextBox_LostFocus_TriggerSmartLogic"/>
                                        </Grid>

                                        <Label Content="Thu phóng chiều dọc" Margin="0,10,0,0"/>
                                        <Grid>
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="*"/>
                                                <ColumnDefinition Width="Auto"/>
                                            </Grid.ColumnDefinitions>
                                            <Slider Grid.Column="0" x:Name="VideoScaleYSlider" Minimum="50" Maximum="200"  Value="{Binding SourceData.ScaleY, Converter={StaticResource PercentageConverter}, Mode=TwoWay}"  VerticalAlignment="Center"  PreviewMouseLeftButtonDown="TransformControl_InteractionStarted" PreviewMouseLeftButtonUp="TransformControl_InteractionCompleted"/>
                                            <TextBox Grid.Column="1" Width="60"  Text="{Binding Value, ElementName=VideoScaleYSlider, StringFormat={}{0:F0}%}" VerticalAlignment="Center" GotFocus="TransformControl_InteractionStarted" LostFocus="TextBox_LostFocus_TriggerSmartLogic"/>
                                        </Grid>
                                    </StackPanel>
                                    <Grid Margin="0,15,0,0">
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="*"/>
                                            <ColumnDefinition Width="Auto"/>
                                        </Grid.ColumnDefinitions>
                                        <TextBlock Grid.Column="0" Text="Thu phóng đồng nhất" VerticalAlignment="Center"/>
                                        <ToggleButton Grid.Column="1" x:Name="UniformScaleToggleButton"  IsChecked="{Binding SourceData.IsUniformScale, Mode=TwoWay}"  Style="{StaticResource ModernToggleSwitchStyle}"/>
                                    </Grid>
                                </StackPanel>
                            </Expander>
                            <Expander Header="Tốc độ" Style="{StaticResource AccordionExpanderStyle}" IsExpanded="True">
                                <StackPanel>
                                    <Label Content="Tốc độ"/>
                                    <Grid>
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="*"/>
                                            <ColumnDefinition Width="Auto"/>
                                        </Grid.ColumnDefinitions>
                                        <Slider Grid.Column="0" x:Name="VideoSpeedSlider" Minimum="0.1" Maximum="5.0"  Value="{Binding SourceData.Speed, Mode=TwoWay}"   TickFrequency="0.1" IsSnapToTickEnabled="False" VerticalAlignment="Center"  PreviewMouseLeftButtonDown="TransformControl_InteractionStarted" PreviewMouseLeftButtonUp="TransformControl_InteractionCompleted"/>
                                        <TextBox Grid.Column="1" Width="60"  Text="{Binding Value, ElementName=VideoSpeedSlider, StringFormat={}{0:F1}x}"  VerticalAlignment="Center"  GotFocus="TransformControl_InteractionStarted" LostFocus="TextBox_LostFocus_TriggerSmartLogic"/>
                                    </Grid>
                                    <Label Content="Thời lượng" Margin="0,10,0,0"/>
                                    <TextBlock Text="{Binding SourceData.EffectiveDuration, StringFormat=Duration: {0:hh\\:mm\\:ss\\.fff}}" 
                       Foreground="{StaticResource CapCut.TextSecondaryColor}"/>
                                </StackPanel>
                            </Expander>
                        </StackPanel>
                    </ScrollViewer>
                </Grid>
                <Popup x:Name="SmartCutPopup"
        IsOpen="{Binding IsSmartCutPopupOpen}"
        Placement="Center"
        PlacementTarget="{Binding ElementName=MainContentGrid}"
        StaysOpen="False"
        AllowsTransparency="True"
        Closed="SmartCutPopup_Closed">
                    <Border Background="{StaticResource CapCut.PanelBackground}"
 BorderBrush="{StaticResource CapCut.BorderColor}"
 BorderThickness="1"
 CornerRadius="8"
 Padding="1">
                        <Border.Effect>
                            <DropShadowEffect BlurRadius="15" 
                   ShadowDepth="0" 
                   Opacity="0.3" 
                   Color="#40000000"/>
                        </Border.Effect>
                        <Grid Margin="16" Width="400">
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="*"/>
                                <RowDefinition Height="Auto"/>
                            </Grid.RowDefinitions>

                            <TextBlock Text="Tự động Khớp Voice" FontSize="16" FontWeight="Bold" Margin="0,0,0,12"/>

                            <StackPanel Grid.Row="1" Orientation="Vertical" VerticalAlignment="Center" HorizontalAlignment="Center" Margin="0,8,0,8">
                                <Button x:Name="SmartCutMode1Button"
                                        Content="Bật Tự động Khớp Voice"
                                        ToolTip="Cắt và co giãn video thông minh để khớp với voice-over."
                                        Height="40" Margin="0,0,0,10"
                                        Click="SmartCutMode1Button_Click"/>

                                <Button x:Name="DisableButton"
                                        Content="Tắt Tự động Khớp Voice"
                                        Height="40" Margin="0,0,0,0"
                                        Click="SmartCutPopup_Disable_Click"/>
                            </StackPanel>
                            <TextBlock Grid.Row="2" Text="Gợi ý: Tính năng này tự động cắt và co giãn video để khớp với voice-over của bạn."
                        Foreground="Gray" FontSize="12" HorizontalAlignment="Center" Margin="0,10,0,0" TextWrapping="Wrap"/>
                        </Grid>
                    </Border>
                </Popup>
            </Grid>
            

            <GridSplitter Grid.Row="2" Height="8" HorizontalAlignment="Stretch" VerticalAlignment="Center" ResizeBehavior="PreviousAndNext"/>

            <Grid Grid.Row="3">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="40"/>
                    <ColumnDefinition Width="*"/>
                </Grid.ColumnDefinitions>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="25"/>
                    <RowDefinition Height="*"/>
                </Grid.RowDefinitions>
                <Border Grid.Row="0" Grid.Column="0" Grid.ColumnSpan="2" Background="{StaticResource CapCut.LighterPanelBackground}" Padding="5,3" BorderBrush="{StaticResource CapCut.BorderColor}" BorderThickness="0,0,0,1">
                    <StackPanel Orientation="Horizontal" VerticalAlignment="Center" HorizontalAlignment="Left">
                        <Button x:Name="SmartCutButton" Content="Tự động Khớp Voice" ToolTip="Cắt và co giãn video thông minh cho khớp voice" Click="SmartCutButton_Click" Padding="8,2" Height="22" Margin="0,0,15,0"/>
                        <Button x:Name="FlipVideoButton" Content="Đảo Ngược Video" ToolTip="Lật video trái ↔ phải" Click="FlipVideoButton_Click" Padding="8,2" Height="22" Margin="0,0,15,0"/>
                        <Button x:Name="SmartMergeButton" ToolTip="Gộp các dòng phụ đề liền kề có nội dung giống hệt nhau" Click="SmartMergeButton_Click" Padding="8,2" Height="22" Margin="0,0,15,0">
                            <StackPanel Orientation="Horizontal">
                                <TextBlock FontFamily="Segoe MDL2 Assets, Segoe UI Symbol, Arial" FontSize="12" VerticalAlignment="Center"/>
                                <TextBlock Text="Smart Merge" Margin="5,0,0,0" VerticalAlignment="Center"/>
                            </StackPanel>
                        </Button>
                        <TextBlock VerticalAlignment="Center" Margin="0,0,10,0" Foreground="{StaticResource CapCut.TextSecondaryColor}"/>
                        <Button x:Name="RewindTimeButton" Content="Lùi Start Time" ToolTip="Lùi thời gian bắt đầu của tất cả phụ đề (trừ clip Text)" Click="RewindTimeButton_Click" Padding="8,2" Height="22"/>
                        <Border Background="{StaticResource CapCut.PanelBackground}" BorderBrush="{StaticResource CapCut.BorderColor}" BorderThickness="1" CornerRadius="3" Width="70" Height="22" VerticalAlignment="Center" Margin="5,0">
                            <Grid>
                                <TextBox x:Name="CustomTimeAdjustTextBox" Text="100" VerticalContentAlignment="Center" HorizontalContentAlignment="Center" Background="Transparent" BorderThickness="0" Padding="0,0,20,0"/>
                                <TextBlock Text="ms" IsHitTestVisible="False" VerticalAlignment="Center" HorizontalAlignment="Right" Margin="0,0,5,0" Foreground="{StaticResource CapCut.TextSecondaryColor}" Opacity="0.7"/>
                            </Grid>
                        </Border>
                        <Button x:Name="AdvanceTimeButton" Content="Tiến End Time" ToolTip="Tăng thời gian kết thúc của tất cả phụ đề (trừ clip Text)" Click="AdvanceTimeButton_Click" Padding="8,2" Height="22"/>
                        <Separator Margin="15,0,5,0"/>
                        <TextBlock Text="Hiển thị:" VerticalAlignment="Center" Margin="0,0,5,0" Foreground="{StaticResource CapCut.TextSecondaryColor}"/>
                        <ComboBox x:Name="SubtitleDisplayModeComboBox" Width="120" VerticalAlignment="Center" SelectedIndex="0" SelectionChanged="SubtitleDisplayModeComboBox_SelectionChanged" DropDownOpened="SubtitleDisplayModeComboBox_DropDownOpened">
                            <ComboBoxItem Content="Phụ Đề gốc" Tag="Original"/>
                            <ComboBoxItem x:Name="TranslatedSubtitleOption" Content="Phụ Đề đã dịch" Tag="Translated"/>
                        </ComboBox>
                        <TextBlock Text="Mode lồng tiếng:" VerticalAlignment="Center" Margin="15,0,5,0" Foreground="{StaticResource CapCut.TextSecondaryColor}"/>
                        <ComboBox x:Name="VoiceoverModeComboBox" Width="120" VerticalAlignment="Center" SelectedIndex="0" SelectionChanged="VoiceoverModeComboBox_SelectionChanged">
                            <ComboBoxItem Content="Mặc định" Tag="Default"/>
                            <ComboBoxItem Content="Giữ Effect" Tag="Ducking"/>
                        </ComboBox>
                    </StackPanel>
                </Border>

                <Border Grid.Row="1" Grid.Column="0" Background="{StaticResource CapCut.LighterPanelBackground}"/>
                <Border x:Name="TimelineRulerHost" Grid.Row="1" Grid.Column="1" Background="{StaticResource CapCut.LighterPanelBackground}" ClipToBounds="True" />
                <Grid Grid.Row="2" Grid.Column="0">
                    <Border Background="{StaticResource CapCut.LighterPanelBackground}" BorderBrush="{StaticResource CapCut.BorderColor}" BorderThickness="0,0,1,0"/>
                    <ItemsControl ItemsSource="{Binding ElementName=TrackBackgroundsControl, Path=ItemsSource}">
                        <ItemsControl.ItemsPanel>
                            <ItemsPanelTemplate>
                                <StackPanel Orientation="Vertical"/>
                            </ItemsPanelTemplate>
                        </ItemsControl.ItemsPanel>
                        <ItemsControl.ItemTemplate>
                            <DataTemplate DataType="{x:Type localModels:TrackBackgroundViewModel}">
                                <Border Height="{Binding Height}" Margin="0,0,0,8" ToolTipService.ShowOnDisabled="True">
                                    <Grid>
                                        <TextBlock x:Name="GlyphIcon" FontFamily="Segoe MDL2 Assets, Segoe UI Symbol, Arial" FontSize="16" HorizontalAlignment="Center" VerticalAlignment="Center" Foreground="{StaticResource CapCut.TextSecondaryColor}">
                                            <TextBlock.Style>
                                                <Style TargetType="TextBlock">
                                                    <Setter Property="Visibility" Value="Collapsed"/>
                                                    <Style.Triggers>
                                                        <DataTrigger Binding="{Binding TrackType}" Value="Video">
                                                            <Setter Property="Visibility" Value="Visible"/>
                                                            <Setter Property="Text" Value="&#xE714;"/>
                                                            <Setter Property="ToolTip" Value="Video Track"/>
                                                        </DataTrigger>
                                                        <DataTrigger Binding="{Binding TrackType}" Value="Image">
                                                            <Setter Property="Visibility" Value="Visible"/>
                                                            <Setter Property="Text" Value="&#xEB9F;"/>
                                                            <Setter Property="ToolTip" Value="Image Track"/>
                                                        </DataTrigger>
                                                        <DataTrigger Binding="{Binding TrackType}" Value="Audio">
                                                            <Setter Property="Visibility" Value="Visible"/>
                                                            <Setter Property="Text" Value="&#xE767;"/>
                                                            <Setter Property="ToolTip" Value="Audio Track"/>
                                                        </DataTrigger>
                                                    </Style.Triggers>
                                                </Style>
                                            </TextBlock.Style>
                                        </TextBlock>
                                        <TextBlock x:Name="TextIcon" Text="Aa" FontSize="16" FontWeight="Bold" HorizontalAlignment="Center" VerticalAlignment="Center" Foreground="{StaticResource CapCut.TextSecondaryColor}">
                                            <TextBlock.Style>
                                                <Style TargetType="TextBlock">
                                                    <Setter Property="Visibility" Value="Collapsed"/>
                                                    <Style.Triggers>
                                                        <DataTrigger Binding="{Binding TrackType}" Value="Subtitle">
                                                            <Setter Property="Visibility" Value="Visible"/>
                                                            <Setter Property="Text" Value="T"/>
                                                            <Setter Property="ToolTip" Value="Subtitle Track"/>
                                                        </DataTrigger>
                                                        <DataTrigger Binding="{Binding TrackType}" Value="Text">
                                                            <Setter Property="Visibility" Value="Visible"/>
                                                            <Setter Property="Text" Value="Aa"/>
                                                            <Setter Property="ToolTip" Value="Text Track"/>
                                                        </DataTrigger>
                                                    </Style.Triggers>
                                                </Style>
                                            </TextBlock.Style>
                                        </TextBlock>
                                    </Grid>
                                </Border>
                            </DataTemplate>
                        </ItemsControl.ItemTemplate>
                    </ItemsControl>
                </Grid>
                <Grid Grid.Row="2" Grid.Column="1">
                    <Grid x:Name="TimelineParentGrid" Background="{StaticResource CapCut.PanelBackground}" PreviewMouseLeftButtonDown="TimelineParentGrid_PreviewMouseLeftButtonDown" AllowDrop="True" DragEnter="Timeline_DragEnter" DragLeave="Timeline_DragLeave" DragOver="Timeline_DragOver" Drop="Timeline_Drop">
                        <ScrollViewer x:Name="TimelineScrollViewer" HorizontalScrollBarVisibility="Auto" VerticalScrollBarVisibility="Auto" PreviewMouseWheel="TimelineScrollViewer_PreviewMouseWheel" ScrollChanged="TimelineScrollViewer_ScrollChanged" SizeChanged="TimelineScrollViewer_SizeChanged">
                            <Grid x:Name="TracksContainerGrid" HorizontalAlignment="Left" VerticalAlignment="Top">
                                <ItemsControl x:Name="TrackBackgroundsControl">
                                    <ItemsControl.ItemsPanel>
                                        <ItemsPanelTemplate>
                                            <StackPanel Orientation="Vertical"/>
                                        </ItemsPanelTemplate>
                                    </ItemsControl.ItemsPanel>
                                    <ItemsControl.ItemTemplate>
                                        <DataTemplate DataType="{x:Type localModels:TrackBackgroundViewModel}">
                                            <Border Height="{Binding Height}" 
            Background="#FF2F3033" 
            BorderBrush="{StaticResource CapCut.BorderColor}" 
            BorderThickness="0,0,0,1" 
            Margin="0,0,0,8"
            Opacity="0.5"/>
                                        </DataTemplate>
                                    </ItemsControl.ItemTemplate>
                                </ItemsControl>
                                <ItemsControl x:Name="MainTimelineControl" ItemsSource="{Binding VisibleTimelineClips}">
                                    <ItemsControl.ItemsPanel>
                                        <ItemsPanelTemplate>
                                            <Canvas/>
                                        </ItemsPanelTemplate>
                                    </ItemsControl.ItemsPanel>
                                    <ItemsControl.ItemTemplateSelector>
                                        <StaticResource ResourceKey="TimelineClipSelector"/>
                                    </ItemsControl.ItemTemplateSelector>
                                    <ItemsControl.ItemContainerStyle>
                                        <Style TargetType="ContentPresenter">
                                            <Setter Property="Canvas.Left" Value="{Binding X}"/>
                                            <Setter Property="Canvas.Top" Value="{Binding Y}"/>
                                            <Setter Property="Width" Value="{Binding Width}"/>
                                            <Setter Property="Height" Value="{Binding Height}"/>
                                            <EventSetter Event="PreviewMouseLeftButtonDown" Handler="TimelineClip_Container_PreviewMouseLeftButtonDown"/>
                                            <EventSetter Event="PreviewMouseLeftButtonUp" Handler="TimelineClip_Container_PreviewMouseLeftButtonUp"/>
                                            <EventSetter Event="Loaded" Handler="TimelineClip_Container_Loaded"/>
                                            <EventSetter Event="ContextMenuOpening" Handler="TimelineClip_Container_ContextMenuOpening"/>
                                            <Setter Property="Panel.ZIndex" Value="0"/>
                                            <Setter Property="ContextMenu">
                                                <Setter.Value>
                                                    <ContextMenu Style="{StaticResource TimelineContextMenuStyle}" DataContext="{Binding PlacementTarget.DataContext, RelativeSource={RelativeSource Self}}"/>
                                                </Setter.Value>
                                            </Setter>
                                            <Style.Triggers>
                                                <DataTrigger Binding="{Binding IsSelected}" Value="True">
                                                    <Setter Property="Panel.ZIndex" Value="10"/>
                                                </DataTrigger>
                                            </Style.Triggers>
                                        </Style>
                                    </ItemsControl.ItemContainerStyle>
                                </ItemsControl>
                                <Canvas x:Name="MarqueeSelectionCanvas" ClipToBounds="True">
                                    <Rectangle x:Name="SelectionRectangle" Stroke="White" StrokeThickness="1" Fill="#40FFFFFF" Visibility="Collapsed" StrokeDashArray="3 2" Panel.ZIndex="99"/>
                                </Canvas>
                            </Grid>
                        </ScrollViewer>
                        <Canvas x:Name="DropOverlayCanvas" IsHitTestVisible="False"/>
                    </Grid>
                    <Rectangle x:Name="ResizeGuideline" Width="1" Fill="{StaticResource CapCut.AccentColorBlue}" IsHitTestVisible="False" Visibility="Collapsed" VerticalAlignment="Stretch" HorizontalAlignment="Left" Panel.ZIndex="99"/>
                    <Rectangle x:Name="MoveSnapGuideline" Width="0.8" Fill="Cyan" IsHitTestVisible="False" Visibility="Collapsed" VerticalAlignment="Stretch" HorizontalAlignment="Left" Panel.ZIndex="99">
                        <Rectangle.Effect>
                            <DropShadowEffect ShadowDepth="0" Color="Cyan" BlurRadius="8" Opacity="0.9"/>
                        </Rectangle.Effect>
                    </Rectangle>
                </Grid>
                <Thumb x:Name="PositionMarkerThumb" Grid.Row="1" Grid.RowSpan="2" Grid.Column="1" HorizontalAlignment="Left" Cursor="SizeWE" VerticalAlignment="Stretch" Panel.ZIndex="100" Background="Transparent"
           DragStarted="PositionMarkerThumb_DragStarted" DragDelta="PositionMarkerThumb_DragDelta" DragCompleted="PositionMarkerThumb_DragCompleted">
                    <Thumb.Template>
                        <ControlTemplate TargetType="Thumb">
                            <Grid Margin="-7,0,0,0">
                                <Border Background="Transparent" Width="14" HorizontalAlignment="Center"/>
                                <Grid VerticalAlignment="Top" HorizontalAlignment="Center" Height="25" Width="14">
                                    <Path Data="M 0 0 L 12 0 L 6 10 Z" Fill="{StaticResource CapCut.AccentColorBlue}" Width="12" Height="10" VerticalAlignment="Bottom" HorizontalAlignment="Center" Margin="0,0,0,1"/>
                                </Grid>
                                <Rectangle Fill="{StaticResource CapCut.AccentColorBlue}" Width="1" HorizontalAlignment="Center" IsHitTestVisible="False" Margin="0,25,0,0"/>
                            </Grid>
                        </ControlTemplate>
                    </Thumb.Template>
                </Thumb>
            </Grid>
            <Grid IsHitTestVisible="False" Visibility="Collapsed">
                <Grid x:Name="TtsPlayerHost"/>
                <MediaElement x:Name="audioPreviewPlayer" LoadedBehavior="Manual" UnloadedBehavior="Stop"/>
            </Grid>


            <Popup x:Name="SavePromptPopup" 
       IsOpen="{Binding IsSavePromptPopupOpen, Mode=TwoWay}"
       Placement="Center" PlacementTarget="{Binding ElementName=MainContentGrid}"
       StaysOpen="False" AllowsTransparency="True"
       PopupAnimation="Fade">
                <Border Background="{StaticResource CapCut.LighterPanelBackground}" 
            BorderBrush="{StaticResource CapCut.BorderColor}" 
            BorderThickness="1" 
            CornerRadius="8" 
            Padding="20"
            MinWidth="300">
                    <StackPanel>
                        <TextBlock Text="Lưu Prompt Tùy Chỉnh" FontSize="16" FontWeight="SemiBold" Margin="0,0,0,15"/>
                        <Label Content="Đặt tên cho prompt:"/>
                        <TextBox x:Name="NewPromptNameTextBox" Text="{Binding NewPromptName, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" Margin="0,0,0,15"/>
                        <StackPanel Orientation="Horizontal" HorizontalAlignment="Right">
                            <Button Content="Hủy" Margin="0,0,10,0" Click="PopupCancelButton_Click"/>
                            <Button Content="Lưu" Style="{StaticResource PrimaryActionButtonStyle}" Click="PopupSaveButton_Click"/>
                        </StackPanel>
                    </StackPanel>
                </Border>
            </Popup>
                <Grid x:Name="BatchProcessingOverlay"
      Grid.Row="0" Grid.RowSpan="4"
      Grid.Column="0" Grid.ColumnSpan="5"
      Background="#A018191C"
      IsHitTestVisible="True"
      Panel.ZIndex="1000"
      Visibility="{Binding IsBatchProcessingPopupOpen, Converter={StaticResource BooleanToVisibilityConverter}, FallbackValue=Collapsed}">

                    <Border Background="{StaticResource CapCut.PanelBackground}"
            BorderBrush="{StaticResource CapCut.BorderColor}"
            BorderThickness="1"
            CornerRadius="8"
            Padding="1"
            MinWidth="600"
            MinHeight="500"
            MaxHeight="700"
            HorizontalAlignment="Center"
            VerticalAlignment="Center">
                        <Border.Effect>
                            <DropShadowEffect BlurRadius="15" ShadowDepth="0" Opacity="0.3" Color="#40000000"/>
                        </Border.Effect>
                        <Grid>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="*"/>
                                <RowDefinition Height="Auto"/>
                            </Grid.RowDefinitions>

                            <!-- Title Bar -->
                            <Border Grid.Row="0" Background="{StaticResource CapCut.LighterPanelBackground}" CornerRadius="8,8,0,0" Padding="15,10">
                                <Grid>
                                    <TextBlock Text="Xử Lý Hàng Loạt" FontSize="16" FontWeight="SemiBold"/>
                                    <Button Content="&#xE711;" FontFamily="Segoe MDL2 Assets, Segoe UI Symbol, Arial"
                            Style="{StaticResource WindowButtonStyle}"
                            HorizontalAlignment="Right"
                            VerticalAlignment="Center"
                            Width="30" Height="30"
                            Click="CloseBatchPopup_Click"
                            ToolTip="Đóng (Sẽ hủy tiến trình nếu đang chạy)"/>
                                </Grid>
                            </Border>

                            <!-- Content with TabControl -->
                            <TabControl Grid.Row="1" x:Name="BatchTabControl" Background="Transparent" BorderThickness="0" Padding="0">
                                <TabControl.Resources>
                                    <Style TargetType="TabItem">
                                        <Setter Property="Template">
                                            <Setter.Value>
                                                <ControlTemplate TargetType="TabItem">
                                                    <Border Name="Border" Background="Transparent" BorderThickness="0,0,0,2" BorderBrush="Transparent" Padding="15,8">
                                                        <ContentPresenter x:Name="ContentSite" ContentSource="Header" HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                                    </Border>
                                                    <ControlTemplate.Triggers>
                                                        <Trigger Property="IsSelected" Value="True">
                                                            <Setter TargetName="Border" Property="BorderBrush" Value="{StaticResource CapCut.AccentColor}"/>
                                                            <Setter Property="Foreground" Value="White"/>
                                                        </Trigger>
                                                        <Trigger Property="IsSelected" Value="False">
                                                            <Setter Property="Foreground" Value="{StaticResource CapCut.TextSecondaryColor}"/>
                                                        </Trigger>
                                                    </ControlTemplate.Triggers>
                                                </ControlTemplate>
                                            </Setter.Value>
                                        </Setter>
                                    </Style>
                                </TabControl.Resources>

                                <!-- Tab 1: Tạo & Dịch Phụ Đề -->
                                <TabItem Header="Tạo &amp; Dịch Phụ Đề">
                                    <Grid>
                                        <Grid.RowDefinitions>
                                            <RowDefinition Height="*"/>
                                            <RowDefinition Height="Auto"/>
                                        </Grid.RowDefinitions>

                                        <ScrollViewer Grid.Row="0" VerticalScrollBarVisibility="Auto" Padding="15">
                                            <StackPanel>
                                                <!-- Folder Selection -->
                                                <TextBlock Text="1. Chọn Thư Mục" Style="{StaticResource SectionHeaderStyle}"/>
                                                <Grid Margin="0,5,0,10">
                                                    <Grid.RowDefinitions>
                                                        <RowDefinition Height="Auto"/>
                                                        <RowDefinition Height="Auto"/>
                                                    </Grid.RowDefinitions>
                                                    <Grid.ColumnDefinitions>
                                                        <ColumnDefinition Width="Auto"/>
                                                        <ColumnDefinition Width="*"/>
                                                        <ColumnDefinition Width="Auto"/>
                                                    </Grid.ColumnDefinitions>

                                                    <Label Grid.Row="0" Grid.Column="0" Content="Thư mục chứa video:" VerticalAlignment="Center"/>
                                                    <TextBox Grid.Row="0" Grid.Column="1" Text="{Binding BatchInputFolderPath}" IsReadOnly="True" VerticalContentAlignment="Center"/>
                                                    <Button Grid.Row="0" Grid.Column="2" Content="Chọn..." Margin="5,0,0,0" Click="SelectBatchInput_Click"/>

                                                    <Label Grid.Row="1" Grid.Column="0" Content="Thư mục lưu kết quả:" VerticalAlignment="Center" Margin="0,5,0,0"/>
                                                    <TextBox Grid.Row="1" Grid.Column="1" Text="{Binding BatchOutputFolderPath}" IsReadOnly="True" VerticalContentAlignment="Center" Margin="0,5,0,0"/>
                                                    <Button Grid.Row="1" Grid.Column="2" Content="Chọn..." Margin="5,5,0,0" Click="SelectBatchOutput_Click"/>
                                                </Grid>

                                                <!-- Subtitle Mode -->
                                                <TextBlock Text="2. Chế Độ Lấy Phụ Đề" Style="{StaticResource SectionHeaderStyle}"/>
                                                <StackPanel Margin="5,5,0,10">
                                                    <RadioButton x:Name="BatchModeHardsubRadio" Content="Hardsub (Từ video)" GroupName="BatchModeGroup" IsChecked="True"/>
                                                    <TextBlock Text="Sẽ sử dụng các cài đặt từ tab Phụ đề." FontSize="11" Foreground="{StaticResource CapCut.TextSecondaryColor}" Margin="20,2,0,0"/>
                                                    <RadioButton x:Name="BatchModeSpeechToTextRadio" Content="Speech-to-text (Từ giọng nói)" GroupName="BatchModeGroup" Margin="0,8,0,0"/>
                                                    <TextBlock Text="Sử dụng WhisperNet (AIOLauncher STT) để nhận dạng giọng nói." FontSize="11" Foreground="{StaticResource CapCut.TextSecondaryColor}" Margin="20,2,0,0"/>
                                                </StackPanel>

                                                <!-- Translation Settings -->
                                                <TextBlock Text="3. Cài Đặt OCR và Dịch" Style="{StaticResource SectionHeaderStyle}"/>
                                                <StackPanel Margin="5,5,0,10">
                                                    <CheckBox x:Name="BatchOnlyCreateOriginalSrtCheckBox"
                          Content="Chỉ tạo phụ đề gốc (không dịch)"
                          Checked="BatchOptionCheckBox_Checked"/>
                                                    <CheckBox x:Name="BatchTranslateCheckBox"
                          Content="Dịch phụ đề sau khi tạo"
                          IsChecked="True"
                          Margin="0,5,0,0"
                          Checked="BatchOptionCheckBox_Checked"/>
                                                </StackPanel>
                                                <!-- Log -->
                                                <TextBlock Text="Log Tiến Trình" Style="{StaticResource SectionHeaderStyle}"/>
                                                <ScrollViewer Height="150" VerticalScrollBarVisibility="Auto" Margin="0,5,0,0" Background="{StaticResource CapCut.WindowBackground}" BorderBrush="{StaticResource CapCut.BorderColor}" BorderThickness="1">
                                                    <TextBlock x:Name="BatchLogTextBlock" Text="{Binding BatchProcessingLog}" Padding="5" TextWrapping="Wrap"/>
                                                </ScrollViewer>
                                            </StackPanel>
                                        </ScrollViewer>

                                        <!-- Actions -->
                                        <Border Grid.Row="1" BorderBrush="{StaticResource CapCut.BorderColor}" BorderThickness="0,1,0,0" Padding="15,10">
                                            <Button x:Name="StartBatchProcessingButton" Content="Bắt Đầu" Style="{StaticResource PrimaryActionButtonStyle}" HorizontalAlignment="Right" Click="StartBatchProcessingButton_Click"/>
                                        </Border>
                                    </Grid>
                                </TabItem>

                                <!-- Tab 2: Dịch SRT Hàng Loạt -->
                                <TabItem Header="Dịch SRT Hàng Loạt">
                                    <Grid>
                                        <Grid.RowDefinitions>
                                            <RowDefinition Height="*"/>
                                            <RowDefinition Height="Auto"/>
                                        </Grid.RowDefinitions>

                                        <ScrollViewer Grid.Row="0" VerticalScrollBarVisibility="Auto" Padding="15">
                                            <StackPanel>
                                                <!-- Folder Selection -->
                                                <TextBlock Text="1. Chọn Thư Mục" Style="{StaticResource SectionHeaderStyle}"/>
                                                <Grid Margin="0,5,0,10">
                                                    <Grid.RowDefinitions>
                                                        <RowDefinition Height="Auto"/>
                                                        <RowDefinition Height="Auto"/>
                                                    </Grid.RowDefinitions>
                                                    <Grid.ColumnDefinitions>
                                                        <ColumnDefinition Width="Auto"/>
                                                        <ColumnDefinition Width="*"/>
                                                        <ColumnDefinition Width="Auto"/>
                                                    </Grid.ColumnDefinitions>

                                                    <Label Grid.Row="0" Grid.Column="0" Content="Thư mục chứa SRT:" VerticalAlignment="Center"/>
                                                    <TextBox Grid.Row="0" Grid.Column="1" Text="{Binding BatchSrtInputFolderPath}" IsReadOnly="True" VerticalContentAlignment="Center"/>
                                                    <Button Grid.Row="0" Grid.Column="2" Content="Chọn..." Margin="5,0,0,0" Click="SelectBatchSrtInput_Click"/>

                                                    <Label Grid.Row="1" Grid.Column="0" Content="Thư mục lưu kết quả:" VerticalAlignment="Center" Margin="0,5,0,0"/>
                                                    <TextBox Grid.Row="1" Grid.Column="1" Text="{Binding BatchSrtOutputFolderPath}" IsReadOnly="True" VerticalContentAlignment="Center" Margin="0,5,0,0"/>
                                                    <Button Grid.Row="1" Grid.Column="2" Content="Chọn..." Margin="5,5,0,0" Click="SelectBatchSrtOutput_Click"/>
                                                </Grid>

                                                <!-- Translation Info -->
                                                <TextBlock Text="2. Thông Tin Dịch" Style="{StaticResource SectionHeaderStyle}"/>
                                                <StackPanel Margin="5,5,0,10">
                                                    <TextBlock x:Name="BatchSrtTranslationInfoText"
                                                               Text="Đang kiểm tra số lần dịch còn lại..."
                                                               FontSize="12"
                                                               Foreground="{StaticResource CapCut.TextSecondaryColor}"/>
                                                    <TextBlock Text="Các file SRT sẽ được dịch theo thứ tự bằng API đã chọn trong Cài đặt."
                                                               FontSize="11"
                                                               Foreground="{StaticResource CapCut.TextSecondaryColor}"
                                                               Margin="0,5,0,0"
                                                               TextWrapping="Wrap"/>
                                                </StackPanel>

                                                <!-- Log -->
                                                <TextBlock Text="Log Tiến Trình" Style="{StaticResource SectionHeaderStyle}"/>
                                                <ScrollViewer Height="200" VerticalScrollBarVisibility="Auto" Margin="0,5,0,0" Background="{StaticResource CapCut.WindowBackground}" BorderBrush="{StaticResource CapCut.BorderColor}" BorderThickness="1">
                                                    <TextBlock x:Name="BatchSrtLogTextBlock" Text="{Binding BatchSrtProcessingLog}" Padding="5" TextWrapping="Wrap"/>
                                                </ScrollViewer>
                                            </StackPanel>
                                        </ScrollViewer>

                                        <!-- Actions -->
                                        <Border Grid.Row="1" BorderBrush="{StaticResource CapCut.BorderColor}" BorderThickness="0,1,0,0" Padding="15,10">
                                            <Button x:Name="StartBatchSrtTranslationButton" Content="Bắt Đầu Dịch" Style="{StaticResource PrimaryActionButtonStyle}" HorizontalAlignment="Right" Click="StartBatchSrtTranslationButton_Click"/>
                                        </Border>
                                    </Grid>
                                </TabItem>
                            </TabControl>
                        </Grid>
                    </Border>
                </Grid>
                <Grid x:Name="LoadingOverlay" Grid.Row="1"  Grid.RowSpan="3"  Background="#A018191C"  Visibility="Collapsed"  IsHitTestVisible="True" Panel.ZIndex="999">
                <Border HorizontalAlignment="Center" 
                        VerticalAlignment="Center"
                        Background="{StaticResource CapCut.PanelBackground}"
                        CornerRadius="8"
                        Padding="10,10"
                        MinWidth="200">
                    <StackPanel>
                        <Image gif:ImageBehavior.AnimatedSource="/Resources/loading.gif" Stretch="None" />
                        <TextBlock Text="Đang xử lý..." Foreground="White" FontSize="16" Margin="0,15,0,0" HorizontalAlignment="Center"/>
                        <Button x:Name="CancelProcessButton" Content="Huỷ Bỏ" Margin="0,20,0,0" Padding="20,8" Click="CancelProcessButton_Click" HorizontalAlignment="Center"/>
                    </StackPanel>
                </Border>
            </Grid>
            </Grid>
            <Border x:Name="SnapshotResultPanel"
    Visibility="Collapsed"
    VerticalAlignment="Top"
    HorizontalAlignment="Center"
    Margin="0,40,0,0"
    Background="#CC1E1E1E"
    BorderBrush="#80777777"
    BorderThickness="1"
    CornerRadius="8"
    MaxWidth="600"
    Padding="12"
    Panel.ZIndex="10000"
    PreviewMouseLeftButtonDown="SnapshotResultPanel_PreviewMouseLeftButtonDown">
                <Border.Effect>
                    <DropShadowEffect ShadowDepth="0" BlurRadius="15" Opacity="0.4"/>
                </Border.Effect>
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>

                    <!-- Nút Đóng -->
                    <Button x:Name="CloseSnapshotResultButton" 
            Content="&#xE711;" 
            FontFamily="Segoe MDL2 Assets, Segoe UI Symbol, Arial" 
            HorizontalAlignment="Right" 
            VerticalAlignment="Top" 
            Grid.Row="0" Grid.RowSpan="2" 
            Width="24" Height="24" 
            Style="{StaticResource PlayerControlButtonStyle}" 
            Margin="-8,-8,0,0"
            Padding="0"
            Click="CloseSnapshotResultButton_Click"/>

                    <!-- Dòng kết quả OCR -->
                    <StackPanel Grid.Row="1" Margin="0,0,0,8">
                        <Grid Margin="0,0,30,0">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>
                            <TextBlock Grid.Column="0" Text="Gốc:" FontWeight="SemiBold" Foreground="{StaticResource CapCut.TextSecondaryColor}" Margin="0,0,8,0" VerticalAlignment="Center"/>
                            <TextBlock Grid.Column="1" x:Name="OcrResultText" Text="Kết quả OCR sẽ hiển thị ở đây..." TextTrimming="CharacterEllipsis" VerticalAlignment="Center" Foreground="White"/>
                            <Button x:Name="OcrCopyButton" Grid.Column="2" Content="&#xE8C8;" FontFamily="Segoe MDL2 Assets, Segoe UI Symbol, Arial" Style="{StaticResource PlayerControlButtonStyle}" Padding="5" Margin="5,0,0,0" ToolTip="Sao chép" Click="OcrCopyButton_Click"/>
                        </Grid>
                    </StackPanel>

                    <!-- Dòng kết quả Dịch (chỉ hiện khi cần) -->
                    <StackPanel Grid.Row="2" x:Name="TranslatedResultRow" Visibility="Collapsed">
                        <Separator Background="{StaticResource CapCut.BorderColor}" Margin="0,0,0,8"/>
                        <Grid Margin="0,0,30,0">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>
                            <TextBlock Grid.Column="0" Text="Dịch:" FontWeight="SemiBold" Foreground="{StaticResource CapCut.TextSecondaryColor}" Margin="0,0,8,0" VerticalAlignment="Center"/>
                            <TextBlock Grid.Column="1" x:Name="TranslatedResultText" Text="Kết quả dịch sẽ hiển thị ở đây..." TextTrimming="CharacterEllipsis" VerticalAlignment="Center" Foreground="#FF66BB6A"/>
                            <Button x:Name="TranslatedCopyButton" Grid.Column="2" Content="&#xE8C8;" FontFamily="Segoe MDL2 Assets, Segoe UI Symbol, Arial" Style="{StaticResource PlayerControlButtonStyle}" Padding="5" Margin="5,0,0,0" ToolTip="Sao chép bản dịch" Click="TranslatedCopyButton_Click"/>
                        </Grid>
                    </StackPanel>
                </Grid>
            </Border>
        </Grid>
    </Border>
</Window>